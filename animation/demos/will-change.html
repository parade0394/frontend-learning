<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>will-change - CSS 动画教程</title>
    <link rel="stylesheet" href="../styles.css" />
    <style>
      .performance-demo {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        margin: 30px 0;
      }

      .perf-box {
        width: 120px;
        height: 120px;
        background: #10b981;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        border-radius: 12px;
        margin: 0 auto;
        cursor: pointer;
        transition: transform 0.3s ease;
      }

      .perf-box:hover {
        transform: translateY(-10px) scale(1.1) rotate(5deg);
      }

      .with-will-change {
        will-change: transform;
      }

      /* 动画示例 */
      .animated-box {
        width: 100px;
        height: 100px;
        background: #10b981;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        border-radius: 12px;
        margin: 0 auto;
        animation: complexMove 3s ease-in-out infinite;
        will-change: transform;
      }

      @keyframes complexMove {
        0%,
        100% {
          transform: translate(0, 0) rotate(0deg);
        }
        25% {
          transform: translate(100px, 0) rotate(90deg);
        }
        50% {
          transform: translate(100px, 50px) rotate(180deg);
        }
        75% {
          transform: translate(0, 50px) rotate(270deg);
        }
      }
    </style>
  </head>
  <body>
    <aside class="sidebar">
      <div class="sidebar-header">
        <h1>CSS 动画教程</h1>
        <a href="../index.html" class="back-home">← 返回首页</a>
      </div>
      <nav class="sidebar-nav">
        <div class="nav-section">
          <h3>性能优化</h3>
          <a href="will-change.html" class="nav-item active">will-change 性能优化</a>
        </div>
      </nav>
    </aside>

    <main class="main-content">
      <div class="demo-page">
        <h1>will-change - 性能优化</h1>
        <p class="subtitle">提前告知浏览器哪些属性将要变化</p>

        <section class="section">
          <h2>什么是 will-change？</h2>
          <p>will-change 是一个性能优化属性，它告诉浏览器某个元素的哪些属性即将发生变化，让浏览器提前做好优化准备。</p>

          <ul>
            <li><strong>作用：</strong>提前创建图层，启用硬件加速</li>
            <li><strong>目的：</strong>让动画更流畅，减少卡顿</li>
            <li><strong>注意：</strong>不要滥用，会消耗额外内存</li>
          </ul>
        </section>

        <section class="section">
          <h2>语法说明</h2>
          <pre class="code-block"><code>
            <span class="keyword">.element</span> { <span class="property">will-change</span>: <span class="value">auto | property-name</span>; }
          </code></pre>

          <ul>
            <li><span class="highlight">auto</span> - 默认值，浏览器自动决定</li>
            <li><span class="highlight">transform</span> - 告知 transform 属性将变化</li>
            <li><span class="highlight">opacity</span> - 告知 opacity 属性将变化</li>
            <li><span class="highlight">left, top</span> - 告知位置属性将变化</li>
            <li><span class="highlight">scroll-position</span> - 告知滚动位置将变化</li>
            <li>可以指定多个属性：<span class="highlight">will-change: transform, opacity</span></li>
          </ul>
        </section>

        <section class="section">
          <h2>使用示例</h2>

          <pre class="code-block"><code>
            <span class="comment">/* 1. 悬停时会变换的元素 */</span> <span class="keyword">.card</span> { <span class="property">will-change</span>:
            <span class="value">transform</span>; <span class="property">transition</span>: <span class="value">transform 0.3s</span>; }

            <span class="keyword">.card:hover</span> { <span class="property">transform</span>: <span class="value">translateY(-10px)</span>; }

            <span class="comment">/* 2. 持续动画的元素 */</span>
            <span class="keyword">.loading-spinner</span> { <span class="property">will-change</span>: <span class="value">transform</span>;
            <span class="property">animation</span>: <span class="value">spin 1s linear infinite</span>; }

            <span class="comment">/* 3. 多个属性 */</span>
            <span class="keyword">.animated-element</span> { <span class="property">will-change</span>: <span class="value">transform, opacity</span>;
            }
          </code></pre>
        </section>

        <section class="section">
          <h2>性能对比演示</h2>
          <p>悬停查看效果（实际性能差异在复杂动画中更明显）</p>

          <div class="performance-demo">
            <div>
              <h3 style="text-align: center; margin-bottom: 20px">未优化</h3>
              <div class="perf-box">悬停我</div>
              <p style="text-align: center; margin-top: 15px; color: #6b7280; font-size: 0.9rem">无 will-change</p>
            </div>

            <div>
              <h3 style="text-align: center; margin-bottom: 20px">已优化</h3>
              <div class="perf-box with-will-change">悬停我</div>
              <p style="text-align: center; margin-top: 15px; color: #6b7280; font-size: 0.9rem">will-change: transform</p>
            </div>
          </div>
        </section>

        <section class="section">
          <h2>示例：复杂动画优化</h2>
          <p>持续运行的复杂动画，使用 will-change 优化</p>

          <div class="demo-area">
            <div class="animated-box">优化</div>
          </div>

          <pre class="code-block"><code>
            <span class="keyword">.animated-box</span> { <span class="property">will-change</span>: <span class="value">transform</span>;
            <span class="property">animation</span>: <span class="value">complexMove 3s ease-in-out infinite</span>; }

            <span class="keyword">@keyframes</span> <span class="value">complexMove</span> { <span class="keyword">0%</span> {
            <span class="property">transform</span>: <span class="value">translate(0, 0) rotate(0deg)</span>; } <span class="keyword">25%</span> {
            <span class="property">transform</span>: <span class="value">translate(100px, 0) rotate(90deg)</span>; }
            <span class="keyword">50%</span> { <span class="property">transform</span>:
            <span class="value">translate(100px, 50px) rotate(180deg)</span>; } <span class="keyword">75%</span> {
            <span class="property">transform</span>: <span class="value">translate(0, 50px) rotate(270deg)</span>; } }
          </code></pre>
        </section>

        <section class="section">
          <h2>⚠️ 使用注意事项</h2>

          <div class="info-box" style="background: #fef3c7; border-left-color: #f59e0b">
            <p style="color: #92400e"><strong>警告：</strong>不要滥用 will-change！过度使用会消耗大量内存，反而降低性能</p>
          </div>

          <h3 style="font-size: 1.2rem; margin: 25px 0 15px 0; color: #059669">✅ 正确使用</h3>
          <ul>
            <li>只在确实需要优化的元素上使用</li>
            <li>用于频繁变化或复杂动画的元素</li>
            <li>动画结束后移除 will-change</li>
            <li>不要在 CSS 中全局设置</li>
          </ul>

          <h3 style="font-size: 1.2rem; margin: 25px 0 15px 0; color: #dc2626">❌ 错误使用</h3>
          <ul>
            <li>给所有元素都加上 will-change</li>
            <li>设置 will-change: all（性能很差）</li>
            <li>在不需要动画的元素上使用</li>
            <li>动画结束后不移除</li>
          </ul>
        </section>

        <section class="section">
          <h2>最佳实践</h2>

          <pre class="code-block"><code>
            <span class="comment">/* 方式 1：CSS 中设置（适合持续动画） */</span> <span class="keyword">.loading-spinner</span> {
            <span class="property">will-change</span>: <span class="value">transform</span>; <span class="property">animation</span>:
            <span class="value">spin 1s linear infinite</span>; }

            <span class="comment">/* 方式 2：JavaScript 动态设置（推荐） */</span>
            <span class="keyword">element</span>.<span class="property">style</span>.<span class="value">willChange</span> =
            <span class="value">'transform'</span>;
            <span class="comment">// 执行动画...</span>
            <span class="keyword">element</span>.<span class="property">addEventListener</span>(<span class="value">'transitionend'</span>, () => {
            <span class="keyword">element</span>.<span class="property">style</span>.<span class="value">willChange</span> =
            <span class="value">'auto'</span>; <span class="comment">// 动画结束后移除</span> });
          </code></pre>

          <div class="info-box">
            <p><strong>推荐：</strong>对于交互触发的动画（如悬停），在 mouseenter 时设置 will-change，在 mouseleave 或动画结束时移除</p>
          </div>
        </section>

        <section class="section">
          <h2>何时使用 will-change？</h2>

          <ul>
            <li>✅ 复杂的 transform 动画（多个变换组合）</li>
            <li>✅ 持续运行的动画（如加载动画）</li>
            <li>✅ 频繁触发的交互动画</li>
            <li>✅ 大量元素同时动画（如列表项）</li>
            <li>✅ 3D 变换动画</li>
            <li>❌ 简单的悬停效果（浏览器已自动优化）</li>
            <li>❌ 一次性的简单动画</li>
            <li>❌ 静态元素</li>
          </ul>
        </section>
      </div>
    </main>
  </body>
</html>
