<!doctype html>
<html data-theme="light" lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IntersectionObserver - DOM å…ƒç´ å°ºå¯¸å’Œä½ç½® API</title>
    <link href="../styles.css" rel="stylesheet" />
    <script type="module" src="/src/theme-sync.js"></script>
  </head>
  <body>
    <!-- å·¦ä¾§è¾¹æ å¯¼èˆª -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <h1>DOM å…ƒç´ å°ºå¯¸å’Œä½ç½® API</h1>
        <a class="back-home" href="../index.html">â† è¿”å›ä¸»é¡µ</a>
      </div>
      <nav class="sidebar-nav">
        <div class="nav-section">
          <h3>åŸºç¡€å±æ€§</h3>
          <a class="nav-item" href="offset.html">offset* å±æ€§</a>
          <a class="nav-item" href="client.html">client* å±æ€§</a>
          <a class="nav-item" href="scroll.html">scroll* å±æ€§</a>
          <a class="nav-item" href="offset-parent.html">offsetParent</a>
        </div>

        <div class="nav-section">
          <h3>æ ¸å¿ƒ API</h3>
          <a class="nav-item" href="bounding-rect.html">getBoundingClientRect()</a>
          <a class="nav-item" href="client-rects.html">getClientRects()</a>
          <a class="nav-item" href="scroll-into-view.html">scrollIntoView()</a>
        </div>

        <div class="nav-section">
          <h3>çª—å£å’Œæ–‡æ¡£</h3>
          <a class="nav-item" href="window-api.html">window API</a>
          <a class="nav-item" href="document-scroll.html">document æ»šåŠ¨å…¼å®¹</a>
        </div>

        <div class="nav-section">
          <h3>ç°ä»£ Observer API</h3>
          <a class="nav-item" href="resize-observer.html">ResizeObserver</a>
          <a class="nav-item active" href="intersection-observer.html">IntersectionObserver</a>
        </div>

        <div class="nav-section">
          <h3>å®æˆ˜åº”ç”¨</h3>
          <a class="nav-item" href="../practical-demos/drag-drop.html">æ‹–æ‹½å…ƒç´ </a>
          <a class="nav-item" href="../practical-demos/snap-align.html">å…ƒç´ å¸é™„å¯¹é½</a>
          <a class="nav-item" href="../practical-demos/tooltip.html">å·¥å…·æç¤ºå®šä½</a>
          <a class="nav-item" href="../practical-demos/dropdown.html">ä¸‹æ‹‰èœå•å®šä½</a>
          <a class="nav-item" href="../practical-demos/modal-center.html">æ¨¡æ€æ¡†å±…ä¸­</a>
          <a class="nav-item" href="../practical-demos/scroll-progress.html">æ»šåŠ¨è¿›åº¦æ¡</a>
        </div>
      </nav>
    </aside>

    <main class="main-content">
      <div class="demo-page">
        <h1>IntersectionObserver</h1>
        <p class="subtitle">å¼‚æ­¥æ£€æµ‹å…ƒç´ æ˜¯å¦è¿›å…¥è§†å£ - ç°ä»£é«˜æ•ˆçš„å¯è§æ€§æ£€æµ‹ API</p>

        <section class="section">
          <h2>API è¯´æ˜</h2>
          <p>
            <span class="highlight">IntersectionObserver</span>
            æä¾›äº†ä¸€ç§å¼‚æ­¥æ£€æµ‹ç›®æ ‡å…ƒç´ ä¸ç¥–å…ˆå…ƒç´ æˆ–è§†å£ç›¸äº¤æƒ…å†µçš„æ–¹æ³•ã€‚ç›¸æ¯”ä¼ ç»Ÿçš„ scroll äº‹ä»¶ç›‘å¬ï¼Œå®ƒå…·æœ‰æ›´å¥½çš„æ€§èƒ½ã€‚
          </p>

          <pre
            class="code-block"
          ><code><span class="keyword">const</span> observer = <span class="keyword">new</span> <span class="function">IntersectionObserver</span>(callback, options);

<span class="comment">// å›è°ƒå‡½æ•°</span>
<span class="keyword">function</span> <span class="function">callback</span>(entries, observer) {
  entries.<span class="function">forEach</span>(entry => {
    <span class="function">console</span>.<span class="function">log</span>(<span class="string">'å…ƒç´ å¯è§æ€§:'</span>, entry.isIntersecting);
    <span class="function">console</span>.<span class="function">log</span>(<span class="string">'ç›¸äº¤æ¯”ä¾‹:'</span>, entry.intersectionRatio);
    <span class="function">console</span>.<span class="function">log</span>(<span class="string">'ç›¸äº¤åŒºåŸŸ:'</span>, entry.intersectionRect);
  });
}

<span class="comment">// é…ç½®é€‰é¡¹</span>
<span class="keyword">const</span> options = {
  root: <span class="value">null</span>,              <span class="comment">// è§†å£</span>
  rootMargin: <span class="string">'0px'</span>,       <span class="comment">// æ ¹è¾¹è·</span>
  threshold: <span class="value">0</span>             <span class="comment">// è§¦å‘é˜ˆå€¼ï¼ˆ0-1ï¼‰</span>
};

<span class="comment">// å¼€å§‹è§‚å¯Ÿ</span>
observer.<span class="function">observe</span>(targetElement);</code></pre>

          <ul>
            <li><strong>isIntersecting</strong> - å…ƒç´ æ˜¯å¦ä¸æ ¹å…ƒç´ ç›¸äº¤ï¼ˆæ˜¯å¦å¯è§ï¼‰</li>
            <li><strong>intersectionRatio</strong> - ç›¸äº¤æ¯”ä¾‹ï¼ˆ0 åˆ° 1ï¼‰</li>
            <li><strong>intersectionRect</strong> - ç›¸äº¤åŒºåŸŸçš„çŸ©å½¢ä¿¡æ¯</li>
            <li><strong>root</strong> - ç”¨ä½œè§†å£çš„å…ƒç´ ï¼Œé»˜è®¤ä¸ºæµè§ˆå™¨è§†å£</li>
            <li><strong>rootMargin</strong> - æ ¹å…ƒç´ çš„è¾¹è·ï¼Œå¯ä»¥æ‰©å¤§æˆ–ç¼©å°è§¦å‘åŒºåŸŸ</li>
            <li><strong>threshold</strong> - è§¦å‘å›è°ƒçš„ç›¸äº¤æ¯”ä¾‹é˜ˆå€¼</li>
          </ul>

          <div class="tip">
            <h4>ğŸ’¡ æ€§èƒ½ä¼˜åŠ¿</h4>
            <p>
              IntersectionObserver ä½¿ç”¨æµè§ˆå™¨å†…éƒ¨ä¼˜åŒ–ï¼Œä¸ä¼šé¢‘ç¹è§¦å‘ä¸»çº¿ç¨‹ã€‚ç›¸æ¯” scroll + getBoundingClientRect
              çš„ç»„åˆï¼Œæ€§èƒ½å¤§å¹…æå‡ã€‚
            </p>
          </div>
        </section>

        <section class="section">
          <h2>ç¤ºä¾‹ 1ï¼šåŸºç¡€ç”¨æ³• - æ£€æµ‹å…ƒç´ æ˜¯å¦å¯è§</h2>
          <p>æ»šåŠ¨é¡µé¢ï¼Œè§‚å¯Ÿå…ƒç´ è¿›å…¥/ç¦»å¼€è§†å£æ—¶çš„çŠ¶æ€å˜åŒ–</p>

          <div
            style="
              height: 120px;
              overflow: hidden;
              border: 2px dashed var(--border-color);
              border-radius: var(--radius-md);
              padding: 15px;
              margin-bottom: 20px;
            "
          >
            <p style="color: var(--text-secondary)">â†“ å‘ä¸‹æ»šåŠ¨æŸ¥çœ‹ç›®æ ‡å…ƒç´  â†“</p>
          </div>

          <div id="demo1" class="demo-container">
            <div id="box1" class="demo-box">ç›®æ ‡å…ƒç´ </div>
          </div>

          <div class="info-panel">
            <h4>å¯è§æ€§çŠ¶æ€</h4>
            <div class="info-row">
              <span class="info-label">isIntersecting:</span>
              <span id="val1-visible" class="info-value">-</span>
            </div>
            <div class="info-row">
              <span class="info-label">ç›¸äº¤æ¯”ä¾‹:</span>
              <span id="val1-ratio" class="info-value">0%</span>
            </div>
            <div class="info-row">
              <span class="info-label">è§¦å‘æ¬¡æ•°:</span>
              <span id="val1-count" class="info-value">0</span>
            </div>
          </div>

          <pre
            class="code-block"
          ><code><span class="keyword">const</span> observer = <span class="keyword">new</span> <span class="function">IntersectionObserver</span>((entries) => {
  entries.<span class="function">forEach</span>(entry => {
    <span class="keyword">if</span> (entry.isIntersecting) {
      <span class="function">console</span>.<span class="function">log</span>(<span class="string">'å…ƒç´ è¿›å…¥è§†å£'</span>);
    } <span class="keyword">else</span> {
      <span class="function">console</span>.<span class="function">log</span>(<span class="string">'å…ƒç´ ç¦»å¼€è§†å£'</span>);
    }
  });
});

observer.<span class="function">observe</span>(document.<span class="function">getElementById</span>(<span class="string">'box'</span>));</code></pre>
        </section>

        <section class="section">
          <h2>ç¤ºä¾‹ 2ï¼šè‡ªå®šä¹‰é˜ˆå€¼ï¼ˆthresholdï¼‰</h2>
          <p>è®¾ç½®å¤šä¸ªè§¦å‘é˜ˆå€¼ï¼Œç²¾ç¡®æ§åˆ¶è§¦å‘æ—¶æœº</p>

          <div id="scroll2" class="scroll-container" style="height: 300px">
            <p style="margin-bottom: 50px; color: var(--text-secondary)">â†“ å‘ä¸‹æ»šåŠ¨ â†“</p>
            <div id="box2" class="demo-box" style="margin: 20px 0">ç›®æ ‡å…ƒç´ </div>
            <p style="margin-top: 100px; color: var(--text-secondary)">ç»§ç»­æ»šåŠ¨...</p>
          </div>

          <div class="info-panel">
            <h4>é˜ˆå€¼è§¦å‘è®°å½•</h4>
            <div class="info-row">
              <span class="info-label">å½“å‰æ¯”ä¾‹:</span>
              <span id="val2-ratio" class="info-value">0%</span>
            </div>
            <div class="info-row">
              <span class="info-label">è§¦å‘é˜ˆå€¼:</span>
              <span id="val2-threshold" class="info-value">-</span>
            </div>
            <div class="info-row">
              <span class="info-label">è§¦å‘å†å²:</span>
              <span id="val2-history" class="info-value">-</span>
            </div>
          </div>

          <button class="control-button" onclick="document.getElementById('scroll2').scrollTop = 0;">é‡ç½®æ»šåŠ¨</button>

          <pre class="code-block"><code><span class="keyword">const</span> options = {
  threshold: [<span class="value">0</span>, <span class="value">0.25</span>, <span class="value">0.5</span>, <span class="value">0.75</span>, <span class="value">1.0</span>]  <span class="comment">// å¤šä¸ªé˜ˆå€¼</span>
};

<span class="keyword">const</span> observer = <span class="keyword">new</span> <span class="function">IntersectionObserver</span>((entries) => {
  entries.<span class="function">forEach</span>(entry => {
    <span class="function">console</span>.<span class="function">log</span>(<span class="string">`å¯è§æ¯”ä¾‹: ${Math.round(entry.intersectionRatio * 100)}%`</span>);
  });
}, options);</code></pre>
        </section>

        <section class="section">
          <h2>ç¤ºä¾‹ 3ï¼šrootMargin - æå‰è§¦å‘</h2>
          <p>ä½¿ç”¨ rootMargin æå‰æˆ–å»¶è¿Ÿè§¦å‘å›è°ƒï¼Œå®ç°å›¾ç‰‡é¢„åŠ è½½ç­‰åœºæ™¯</p>

          <div id="scroll3" class="scroll-container" style="height: 300px">
            <p style="margin-bottom: 50px; color: var(--text-secondary)">â†“ å‘ä¸‹æ»šåŠ¨ï¼ˆå…ƒç´ è¿›å…¥å‰ 100px å°±ä¼šè§¦å‘ï¼‰â†“</p>
            <div id="box3" class="demo-box" style="margin: 20px 0; background: #3b82f6">ç›®æ ‡å…ƒç´ </div>
            <p style="margin-top: 100px; color: var(--text-secondary)">ç»§ç»­æ»šåŠ¨...</p>
          </div>

          <div class="info-panel">
            <h4>æå‰è§¦å‘æ£€æµ‹</h4>
            <div class="info-row">
              <span class="info-label">çŠ¶æ€:</span>
              <span id="val3-status" class="info-value">ç­‰å¾…ä¸­</span>
            </div>
            <div class="info-row">
              <span class="info-label">åˆ°è§†å£è·ç¦»:</span>
              <span id="val3-distance" class="info-value">0px</span>
            </div>
            <div class="info-row">
              <span class="info-label">rootMargin:</span>
              <span class="info-value">100px</span>
            </div>
          </div>

          <button class="control-button" onclick="document.getElementById('scroll3').scrollTop = 0;">é‡ç½®æ»šåŠ¨</button>

          <div class="tip">
            <h4>ğŸ’¡ åº”ç”¨åœºæ™¯</h4>
            <p>
              rootMargin: '100px' è¡¨ç¤ºå…ƒç´ è·ç¦»è§†å£è¿˜æœ‰ 100px
              æ—¶å°±ä¼šè§¦å‘å›è°ƒã€‚è¿™å¯¹äºå›¾ç‰‡æ‡’åŠ è½½éå¸¸æœ‰ç”¨ï¼Œå¯ä»¥åœ¨ç”¨æˆ·çœ‹åˆ°å›¾ç‰‡ä¹‹å‰å°±å¼€å§‹åŠ è½½ã€‚
            </p>
          </div>
        </section>

        <section class="section">
          <h2>ç¤ºä¾‹ 4ï¼šæ— é™æ»šåŠ¨</h2>
          <p>æ£€æµ‹åˆ°åº•éƒ¨å…ƒç´ æ—¶è‡ªåŠ¨åŠ è½½æ›´å¤šå†…å®¹</p>

          <div id="scroll4" class="scroll-container" style="height: 350px">
            <div id="content4">
              <p style="padding: 10px; color: var(--text-secondary)">å†…å®¹é¡¹ 1</p>
              <p style="padding: 10px; color: var(--text-secondary)">å†…å®¹é¡¹ 2</p>
              <p style="padding: 10px; color: var(--text-secondary)">å†…å®¹é¡¹ 3</p>
            </div>
            <div id="loading4" class="demo-box" style="margin: 20px auto; min-width: 200px; background: #f59e0b">
              åŠ è½½ä¸­...
            </div>
          </div>

          <div class="info-panel">
            <h4>åŠ è½½çŠ¶æ€</h4>
            <div class="info-row">
              <span class="info-label">åŠ è½½æŒ‡ç¤ºå™¨çŠ¶æ€:</span>
              <span id="val4-status" class="info-value">æ£€æµ‹ä¸­</span>
            </div>
            <div class="info-row">
              <span class="info-label">å·²åŠ è½½é¡¹æ•°:</span>
              <span id="val4-count" class="info-value">3</span>
            </div>
          </div>

          <pre
            class="code-block"
          ><code><span class="keyword">const</span> observer = <span class="keyword">new</span> <span class="function">IntersectionObserver</span>((entries) => {
  <span class="keyword">if</span> (entries[<span class="value">0</span>].isIntersecting) {
    <span class="comment">// åŠ è½½æ›´å¤šå†…å®¹</span>
    <span class="function">loadMoreContent</span>();
  }
}, {
  rootMargin: <span class="string">'100px'</span>  <span class="comment">// æå‰ 100px è§¦å‘</span>
});

observer.<span class="function">observe</span>(document.<span class="function">getElementById</span>(<span class="string">'loading'</span>));</code></pre>
        </section>

        <section class="section">
          <h2>ç¤ºä¾‹ 5ï¼šæ‡’åŠ è½½å›¾ç‰‡</h2>
          <p>å›¾ç‰‡è¿›å…¥è§†å£æ—¶æ‰åŠ è½½ src</p>

          <div id="scroll5" class="scroll-container" style="height: 400px">
            <p style="margin-bottom: 30px; color: var(--text-secondary)">â†“ å‘ä¸‹æ»šåŠ¨æŸ¥çœ‹å›¾ç‰‡åŠ è½½æ•ˆæœ â†“</p>

            <div class="image-item" style="margin-bottom: 30px; text-align: center">
              <div class="lazy-image" data-src="https://via.placeholder.com/300x200/3b82f6/ffffff?text=Image+1">
                <span style="color: var(--text-secondary)">å›¾ç‰‡ 1 - ç­‰å¾…åŠ è½½</span>
              </div>
            </div>

            <div class="image-item" style="margin-bottom: 30px; text-align: center">
              <div class="lazy-image" data-src="https://via.placeholder.com/300x200/10b981/ffffff?text=Image+2">
                <span style="color: var(--text-secondary)">å›¾ç‰‡ 2 - ç­‰å¾…åŠ è½½</span>
              </div>
            </div>

            <div class="image-item" style="margin-bottom: 30px; text-align: center">
              <div class="lazy-image" data-src="https://via.placeholder.com/300x200/ef4444/ffffff?text=Image+3">
                <span style="color: var(--text-secondary)">å›¾ç‰‡ 3 - ç­‰å¾…åŠ è½½</span>
              </div>
            </div>

            <p style="margin-top: 50px; color: var(--text-secondary)">ç»§ç»­æ»šåŠ¨...</p>
          </div>

          <div class="info-panel">
            <h4>åŠ è½½ç»Ÿè®¡</h4>
            <div class="info-row">
              <span class="info-label">å·²åŠ è½½å›¾ç‰‡:</span>
              <span id="val5-count" class="info-value">0 / 3</span>
            </div>
          </div>

          <button class="control-button secondary" onclick="resetLazyLoad()">é‡ç½®æ¼”ç¤º</button>

          <pre
            class="code-block"
          ><code><span class="keyword">const</span> imageObserver = <span class="keyword">new</span> <span class="function">IntersectionObserver</span>((entries, observer) => {
  entries.<span class="function">forEach</span>(entry => {
    <span class="keyword">if</span> (entry.isIntersecting) {
      <span class="keyword">const</span> img = entry.target;
      <span class="keyword">const</span> src = img.<span class="function">getAttribute</span>(<span class="string">'data-src'</span>);

      <span class="comment">// åŠ è½½å›¾ç‰‡</span>
      img.src = src;
      img.classList.<span class="function">add</span>(<span class="string">'loaded'</span>);

      <span class="comment">// åœæ­¢è§‚å¯Ÿå·²åŠ è½½çš„å›¾ç‰‡</span>
      observer.<span class="function">unobserve</span>(img);
    }
  });
});

document.<span class="function">querySelectorAll</span>(<span class="string">'.lazy-image'</span>).<span class="function">forEach</span>(img => {
  imageObserver.<span class="function">observe</span>(img);
});</code></pre>
        </section>

        <section class="section">
          <h2>ç¤ºä¾‹ 6ï¼šè§†å·®åŠ¨ç”»</h2>
          <p>æ ¹æ®å…ƒç´ åœ¨è§†å£ä¸­çš„ä½ç½®å®ç°å¹³æ»‘çš„åŠ¨ç”»æ•ˆæœ</p>

          <div id="scroll6" class="scroll-container" style="height: 500px">
            <div id="parallax6" class="demo-box" style="margin: 100px auto; transition: transform 0.1s ease-out">
              è§†å·®å…ƒç´ 
            </div>
          </div>

          <div class="info-panel">
            <h4>åŠ¨ç”»çŠ¶æ€</h4>
            <div class="info-row">
              <span class="info-label">å¯è§æ¯”ä¾‹:</span>
              <span id="val6-ratio" class="info-value">0%</span>
            </div>
            <div class="info-row">
              <span class="info-label">ç¼©æ”¾æ¯”ä¾‹:</span>
              <span id="val6-scale" class="info-value">1.0</span>
            </div>
          </div>

          <button class="control-button" onclick="document.getElementById('scroll6').scrollTop = 0;">é‡ç½®æ»šåŠ¨</button>

          <pre
            class="code-block"
          ><code><span class="keyword">const</span> observer = <span class="keyword">new</span> <span class="function">IntersectionObserver</span>((entries) => {
  entries.<span class="function">forEach</span>(entry => {
    <span class="keyword">const</span> ratio = entry.intersectionRatio;

    <span class="comment">// æ ¹æ®å¯è§æ¯”ä¾‹è°ƒæ•´ç¼©æ”¾</span>
    <span class="keyword">const</span> scale = <span class="value">0.5</span> + (ratio * <span class="value">0.5</span>);
    entry.target.style.transform = <span class="string">`scale(${scale})`</span>;
  });
}, {
  threshold: Array.<span class="function">from</span>({length: <span class="value">100</span>}, (_, i) => i / <span class="value">100</span>)  <span class="comment">// 0% åˆ° 100% æ¯éš” 1%</span>
});</code></pre>
        </section>

        <section class="section">
          <h2>æµè§ˆå™¨å…¼å®¹æ€§</h2>
          <table class="compatibility-table">
            <thead>
              <tr>
                <th>API</th>
                <th>Chrome</th>
                <th>Firefox</th>
                <th>Safari</th>
                <th>Edge</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>IntersectionObserver</td>
                <td class="supported">âœ“ 51+</td>
                <td class="supported">âœ“ 55+</td>
                <td class="supported">âœ“ 12.1+</td>
                <td class="supported">âœ“ 15+</td>
              </tr>
              <tr>
                <td>IntersectionObserver v2</td>
                <td class="supported">âœ“ 74+</td>
                <td class="partial">éƒ¨åˆ†æ”¯æŒ</td>
                <td class="not-supported">âœ—</td>
                <td class="supported">âœ“ 79+</td>
              </tr>
            </tbody>
          </table>

          <div class="note">
            <h4>ğŸ’¡ Polyfill</h4>
            <p>
              å¯¹äºä¸æ”¯æŒ IntersectionObserver çš„æµè§ˆå™¨ï¼Œå¯ä»¥ä½¿ç”¨
              <a href="https://github.com/w3c/IntersectionObserver" target="_blank" style="color: var(--primary)"
                >W3C polyfill</a
              >
            </p>
          </div>
        </section>

        <section class="section">
          <h2>æ€»ç»“</h2>
          <ul>
            <li><strong>é«˜æ€§èƒ½</strong>ï¼šä¸ä¼šé¢‘ç¹è§¦å‘å›è°ƒï¼Œæ€§èƒ½ä¼˜äº scroll äº‹ä»¶</li>
            <li><strong>å¼‚æ­¥</strong>ï¼šä¸é˜»å¡ä¸»çº¿ç¨‹ï¼Œç”¨æˆ·ä½“éªŒæ›´å¥½</li>
            <li><strong>çµæ´»é…ç½®</strong>ï¼šæ”¯æŒ threshold å’Œ rootMargin ç²¾ç¡®æ§åˆ¶è§¦å‘æ—¶æœº</li>
            <li><strong>å¸¸ç”¨åœºæ™¯</strong>ï¼šå›¾ç‰‡æ‡’åŠ è½½ã€æ— é™æ»šåŠ¨ã€åŠ¨ç”»è§¦å‘ã€å¹¿å‘Šæ›å…‰ç»Ÿè®¡ç­‰</li>
            <li><strong>æ³¨æ„äº‹é¡¹</strong>ï¼šå›è°ƒä¸­é¿å…å¤æ‚è®¡ç®—ï¼Œè§‚å¯Ÿåè®°å¾—åœ¨é€‚å½“æ—¶æœº unobserve</li>
          </ul>
        </section>
      </div>
    </main>

    <script>
      // ç¤ºä¾‹ 1ï¼šåŸºç¡€ç”¨æ³•
      const box1 = document.getElementById('box1');
      let count1 = 0;

      const observer1 = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
          count1++;
          document.getElementById('val1-visible').textContent = entry.isIntersecting ? 'âœ“ å¯è§' : 'âœ— ä¸å¯è§';
          document.getElementById('val1-visible').style.color = entry.isIntersecting
            ? 'var(--success)'
            : 'var(--error)';
          document.getElementById('val1-ratio').textContent = Math.round(entry.intersectionRatio * 100) + '%';
          document.getElementById('val1-count').textContent = count1;
        });
      });

      observer1.observe(box1);

      // ç¤ºä¾‹ 2ï¼šè‡ªå®šä¹‰é˜ˆå€¼
      const box2 = document.getElementById('box2');
      const history2 = [];

      const observer2 = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            const ratio = Math.round(entry.intersectionRatio * 100);
            document.getElementById('val2-ratio').textContent = ratio + '%';

            // è®°å½•è§¦å‘çš„é˜ˆå€¼
            const thresholds = [0, 25, 50, 75, 100];
            thresholds.forEach((t) => {
              if (Math.abs(ratio - t) <= 2) {
                history2.push(t + '%');
                document.getElementById('val2-threshold').textContent = t + '%';
              }
            });

            document.getElementById('val2-history').textContent = history2.slice(-5).join(' â†’ ');
          });
        },
        { threshold: [0, 0.25, 0.5, 0.75, 1.0] }
      );

      observer2.observe(box2);

      // ç¤ºä¾‹ 3ï¼šrootMargin
      const box3 = document.getElementById('box3');
      const scroll3 = document.getElementById('scroll3');

      const observer3 = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              document.getElementById('val3-status').textContent = 'âœ“ å·²è¿›å…¥';
              document.getElementById('val3-status').style.color = 'var(--success)';
            } else {
              document.getElementById('val3-status').textContent = 'âœ— å·²ç¦»å¼€';
              document.getElementById('val3-status').style.color = 'var(--error)';
            }
          });
        },
        { rootMargin: '100px' }
      );

      observer3.observe(box3);

      scroll3.addEventListener('scroll', () => {
        const rect = box3.getBoundingClientRect();
        const distance = Math.max(0, rect.top - scroll3.offsetHeight);
        document.getElementById('val3-distance').textContent = Math.round(distance) + 'px';
      });

      // ç¤ºä¾‹ 4ï¼šæ— é™æ»šåŠ¨
      const loading4 = document.getElementById('loading4');
      const content4 = document.getElementById('content4');
      let count4 = 3;

      const observer4 = new IntersectionObserver(
        (entries) => {
          if (entries[0].isIntersecting) {
            document.getElementById('val4-status').textContent = 'åŠ è½½ä¸­...';
            document.getElementById('val4-status').style.color = 'var(--warning)';

            // æ¨¡æ‹Ÿå¼‚æ­¥åŠ è½½
            setTimeout(() => {
              const newItem = document.createElement('p');
              newItem.style.padding = '10px';
              newItem.style.color = 'var(--text-secondary)';
              newItem.textContent = `å†…å®¹é¡¹ ${++count4}`;
              content4.appendChild(newItem);

              document.getElementById('val4-count').textContent = count4;
              document.getElementById('val4-status').textContent = 'âœ“ å·²åŠ è½½';
              document.getElementById('val4-status').style.color = 'var(--success)';

              // æ»šåŠ¨åˆ°åº•éƒ¨
              const scrollContainer = document.getElementById('scroll4');
              scrollContainer.scrollTop = scrollContainer.scrollHeight;
            }, 500);
          }
        },
        { rootMargin: '100px' }
      );

      observer4.observe(loading4);

      // ç¤ºä¾‹ 5ï¼šæ‡’åŠ è½½å›¾ç‰‡
      let loadedCount5 = 0;

      const imageObserver = new IntersectionObserver(
        (entries, observer) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              const container = entry.target;
              const src = container.getAttribute('data-src');

              // æ¨¡æ‹Ÿå›¾ç‰‡åŠ è½½
              container.innerHTML = `<img src="${src}" alt="Lazy loaded image" style="max-width: 100%; border-radius: 8px;" />`;
              container.classList.add('loaded');

              loadedCount5++;
              document.getElementById('val5-count').textContent = `${loadedCount5} / 3`;

              observer.unobserve(container);
            }
          });
        },
        { rootMargin: '50px' }
      );

      function initLazyLoad() {
        loadedCount5 = 0;
        document.querySelectorAll('.lazy-image').forEach((img) => {
          img.innerHTML = `<span style="color: var(--text-secondary);">${img.querySelector('span')?.textContent || 'ç­‰å¾…åŠ è½½'}</span>`;
          imageObserver.observe(img);
        });
        document.getElementById('val5-count').textContent = '0 / 3';
      }

      initLazyLoad();

      window.resetLazyLoad = function () {
        imageObserver.disconnect();
        document.getElementById('scroll5').scrollTop = 0;
        initLazyLoad();
      };

      // ç¤ºä¾‹ 6ï¼šè§†å·®åŠ¨ç”»
      const parallax6 = document.getElementById('parallax6');

      const observer6 = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            const ratio = entry.intersectionRatio;
            const scale = 0.5 + ratio * 0.5;

            parallax6.style.transform = `scale(${scale})`;
            document.getElementById('val6-ratio').textContent = Math.round(ratio * 100) + '%';
            document.getElementById('val6-scale').textContent = scale.toFixed(2);
          });
        },
        { threshold: Array.from({ length: 101 }, (_, i) => i / 100) }
      );

      observer6.observe(parallax6);
    </script>

    <style>
      .image-item {
        padding: 20px;
      }

      .lazy-image {
        min-height: 200px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--bg-secondary);
        border: 2px dashed var(--border-color);
        border-radius: var(--radius-md);
      }
    </style>
  </body>
</html>
