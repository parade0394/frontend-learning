<!doctype html>
<html data-theme="light" lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ResizeObserver - DOM å…ƒç´ å°ºå¯¸å’Œä½ç½® API</title>
    <link href="../styles.css" rel="stylesheet" />
    <script type="module" src="/src/theme-sync.js"></script>
  </head>
  <body>
    <aside class="sidebar">
      <div class="sidebar-header">
        <h1>DOM å…ƒç´ å°ºå¯¸å’Œä½ç½® API</h1>
        <a class="back-home" href="../index.html">â† è¿”å›ä¸»é¡µ</a>
      </div>
      <nav class="sidebar-nav">
        <div class="nav-section">
          <h3>åŸºç¡€å±æ€§</h3>
          <a class="nav-item" href="offset.html">offset* å±æ€§</a>
          <a class="nav-item" href="client.html">client* å±æ€§</a>
          <a class="nav-item" href="scroll.html">scroll* å±æ€§</a>
          <a class="nav-item" href="offset-parent.html">offsetParent</a>
        </div>

        <div class="nav-section">
          <h3>æ ¸å¿ƒ API</h3>
          <a class="nav-item" href="bounding-rect.html">getBoundingClientRect()</a>
          <a class="nav-item" href="client-rects.html">getClientRects()</a>
          <a class="nav-item" href="scroll-into-view.html">scrollIntoView()</a>
        </div>

        <div class="nav-section">
          <h3>çª—å£å’Œæ–‡æ¡£</h3>
          <a class="nav-item" href="window-api.html">window API</a>
          <a class="nav-item" href="document-scroll.html">document æ»šåŠ¨å…¼å®¹</a>
        </div>

        <div class="nav-section">
          <h3>ç°ä»£ Observer API</h3>
          <a class="nav-item active" href="resize-observer.html">ResizeObserver</a>
          <a class="nav-item" href="intersection-observer.html">IntersectionObserver</a>
        </div>

        <div class="nav-section">
          <h3>å®æˆ˜åº”ç”¨</h3>
          <a class="nav-item" href="../practical-demos/drag-drop.html">æ‹–æ‹½å…ƒç´ </a>
          <a class="nav-item" href="../practical-demos/snap-align.html">å…ƒç´ å¸é™„å¯¹é½</a>
          <a class="nav-item" href="../practical-demos/tooltip.html">å·¥å…·æç¤ºå®šä½</a>
          <a class="nav-item" href="../practical-demos/dropdown.html">ä¸‹æ‹‰èœå•å®šä½</a>
          <a class="nav-item" href="../practical-demos/modal-center.html">æ¨¡æ€æ¡†å±…ä¸­</a>
          <a class="nav-item" href="../practical-demos/scroll-progress.html">æ»šåŠ¨è¿›åº¦æ¡</a>
        </div>
      </nav>
    </aside>

    <main class="main-content">
      <div class="demo-page">
        <h1>ResizeObserver</h1>
        <p class="subtitle">é«˜æ•ˆç›‘å¬å…ƒç´ å°ºå¯¸å˜åŒ–çš„ç°ä»£ API</p>

        <section class="section">
          <h2>API è¯´æ˜</h2>
          <p>
            <span class="highlight">ResizeObserver</span> æä¾›äº†ä¸€ç§é«˜æ•ˆç›‘å¬å…ƒç´ å°ºå¯¸å˜åŒ–çš„æ–¹æ³•ã€‚ç›¸æ¯” window.resize
            äº‹ä»¶ï¼Œå®ƒå¯ä»¥ç²¾ç¡®ç›‘å¬å•ä¸ªå…ƒç´ çš„å˜åŒ–ï¼Œæ€§èƒ½æ›´å¥½ã€‚
          </p>

          <pre
            class="code-block"
          ><code><span class="keyword">const</span> observer = <span class="keyword">new</span> <span class="function">ResizeObserver</span>(entries => {
  <span class="keyword">for</span> (<span class="keyword">let</span> entry <span class="keyword">of</span> entries) {
    <span class="function">console</span>.<span class="function">log</span>(<span class="string">'å…ƒç´ å°ºå¯¸:'</span>, entry.contentRect);
    <span class="function">console</span>.<span class="function">log</span>(<span class="string">'å®½åº¦:'</span>, entry.contentRect.width);
    <span class="function">console</span>.<span class="function">log</span>(<span class="string">'é«˜åº¦:'</span>, entry.contentRect.height);
  }
});

<span class="comment">// å¼€å§‹è§‚å¯Ÿ</span>
observer.<span class="function">observe</span>(element);

<span class="comment">// åœæ­¢è§‚å¯Ÿ</span>
observer.<span class="function">unobserve</span>(element);

<span class="comment">// å®Œå…¨åœæ­¢</span>
observer.<span class="function">disconnect</span>();</code></pre>

          <ul>
            <li><strong>contentRect</strong> - å…ƒç´ çš„å†…å®¹åŒºåŸŸçŸ©å½¢ï¼ˆä¸å« border å’Œ paddingï¼‰</li>
            <li><strong>borderBoxSize</strong> - å…ƒç´ çš„ border-box å°ºå¯¸</li>
            <li><strong>contentBoxSize</strong> - å…ƒç´ çš„ content-box å°ºå¯¸</li>
          </ul>

          <div class="tip">
            <h4>ğŸ’¡ ä¼˜åŠ¿</h4>
            <p>ResizeObserver å¯ä»¥ç›‘å¬ä»»æ„å…ƒç´ çš„å°ºå¯¸å˜åŒ–ï¼Œä¸ä»…ä»…æ˜¯çª—å£ã€‚å®ƒæ¯”è½®è¯¢æ£€æŸ¥æˆ–ä½¿ç”¨ MutationObserver æ›´é«˜æ•ˆã€‚</p>
          </div>
        </section>

        <section class="section">
          <h2>ç¤ºä¾‹ 1ï¼šåŸºç¡€ç”¨æ³•</h2>
          <p>è°ƒæ•´å…ƒç´ å¤§å°ï¼Œè§‚å¯Ÿå°ºå¯¸å˜åŒ–</p>

          <div class="demo-container">
            <div id="box1" class="demo-box" style="width: 200px; height: 150px">è°ƒæ•´æˆ‘çš„å¤§å°</div>
          </div>

          <div style="margin: 20px 0">
            <label style="display: block; margin-bottom: 10px; color: var(--text-secondary)">
              å®½åº¦: <span id="width1-val">200</span>px
            </label>
            <input id="width1" type="range" value="200" min="100" max="350" style="width: 100%" />
          </div>

          <div style="margin: 20px 0">
            <label style="display: block; margin-bottom: 10px; color: var(--text-secondary)">
              é«˜åº¦: <span id="height1-val">150</span>px
            </label>
            <input id="height1" type="range" value="150" min="100" max="300" style="width: 100%" />
          </div>

          <div class="info-panel">
            <h4>å®æ—¶æ•°æ®</h4>
            <div class="info-row">
              <span class="info-label">contentRect.width:</span>
              <span id="val1-width" class="info-value">0px</span>
            </div>
            <div class="info-row">
              <span class="info-label">contentRect.height:</span>
              <span id="val1-height" class="info-value">0px</span>
            </div>
            <div class="info-row">
              <span class="info-label">å˜åŒ–æ¬¡æ•°:</span>
              <span id="val1-count" class="info-value">0</span>
            </div>
          </div>

          <pre
            class="code-block"
          ><code><span class="keyword">const</span> observer = <span class="keyword">new</span> <span class="function">ResizeObserver</span>(entries => {
  <span class="keyword">for</span> (<span class="keyword">let</span> entry <span class="keyword">of</span> entries) {
    <span class="keyword">const</span> { width, height } = entry.contentRect;
    <span class="function">console</span>.<span class="function">log</span>(<span class="string">`æ–°å°ºå¯¸: ${width} Ã— ${height}`</span>);
  }
});

observer.<span class="function">observe</span>(document.<span class="function">getElementById</span>(<span class="string">'box'</span>));</code></pre>
        </section>

        <section class="section">
          <h2>ç¤ºä¾‹ 2ï¼šå“åº”å¼ç»„ä»¶</h2>
          <p>æ ¹æ®å®¹å™¨å°ºå¯¸è‡ªåŠ¨è°ƒæ•´å¸ƒå±€</p>

          <div id="container2" class="demo-container" style="width: 100%; max-width: 600px; margin: 0 auto">
            <div
              id="responsive-box"
              style="
                background: var(--primary);
                color: white;
                padding: 20px;
                border-radius: 8px;
                transition: all 0.3s ease;
              "
            >
              <h3 style="margin: 0 0 10px">å“åº”å¼ç»„ä»¶</h3>
              <p style="margin: 0">å½“å‰å¸ƒå±€: <strong id="layout-mode">-</strong></p>
              <p style="margin: 10px 0 0">å®¹å™¨å®½åº¦: <strong id="container-width">-</strong></p>
            </div>
          </div>

          <div style="margin: 20px 0">
            <label style="display: block; margin-bottom: 10px; color: var(--text-secondary)"> è°ƒæ•´å®¹å™¨å®½åº¦ </label>
            <input id="width2" type="range" value="600" min="300" max="600" style="width: 100%" />
          </div>

          <div class="tip">
            <h4>ğŸ’¡ å®é™…åº”ç”¨</h4>
            <p>
              è¿™æ˜¯å“åº”å¼ç»„ä»¶çš„åŸºç¡€ã€‚ä½ å¯ä»¥æ ¹æ®å®¹å™¨å®½åº¦åˆ‡æ¢ä¸åŒçš„å¸ƒå±€æ¨¡å¼ï¼Œå®ç°çœŸæ­£çš„å“åº”å¼è®¾è®¡ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¾èµ–åª’ä½“æŸ¥è¯¢ã€‚
            </p>
          </div>
        </section>

        <section class="section">
          <h2>ç¤ºä¾‹ 3ï¼šç›‘å¬å¤šä¸ªå…ƒç´ </h2>
          <p>åŒæ—¶è§‚å¯Ÿå¤šä¸ªå…ƒç´ çš„å°ºå¯¸å˜åŒ–</p>

          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px">
            <div>
              <div id="box3a" class="demo-box" style="width: 100%; height: 100px">å…ƒç´  A</div>
              <input
                class="size-control"
                type="range"
                value="100"
                data-target="box3a"
                min="80"
                max="150"
                style="width: 100%; margin-top: 10px"
              />
            </div>
            <div>
              <div id="box3b" class="demo-box" style="width: 100%; height: 100px; background: #3b82f6">å…ƒç´  B</div>
              <input
                class="size-control"
                type="range"
                value="100"
                data-target="box3b"
                min="80"
                max="150"
                style="width: 100%; margin-top: 10px"
              />
            </div>
            <div>
              <div id="box3c" class="demo-box" style="width: 100%; height: 100px; background: #ef4444">å…ƒç´  C</div>
              <input
                class="size-control"
                type="range"
                value="100"
                data-target="box3c"
                min="80"
                max="150"
                style="width: 100%; margin-top: 10px"
              />
            </div>
          </div>

          <div class="info-panel" style="margin-top: 20px">
            <h4>å˜åŒ–æ—¥å¿—</h4>
            <div
              id="log3"
              style="max-height: 150px; overflow-y: auto; font-size: 0.85rem; color: var(--text-secondary)"
            >
              <p>ç­‰å¾…å°ºå¯¸å˜åŒ–...</p>
            </div>
          </div>

          <pre class="code-block"><code><span class="comment">// è§‚å¯Ÿå¤šä¸ªå…ƒç´ </span>
<span class="keyword">const</span> observer = <span class="keyword">new</span> <span class="function">ResizeObserver</span>(entries => {
  entries.<span class="function">forEach</span>(entry => {
    <span class="function">console</span>.<span class="function">log</span>(<span class="string">`${entry.target.id}:`</span>, entry.contentRect);
  });
});

[el1, el2, el3].<span class="function">forEach</span>(el => observer.<span class="function">observe</span>(el));</code></pre>
        </section>

        <section class="section">
          <h2>ç¤ºä¾‹ 4ï¼šæ€§èƒ½ä¼˜åŒ–ï¼ˆthrottleï¼‰</h2>
          <p>åœ¨å›è°ƒä¸­ä½¿ç”¨ throttle é¿å…è¿‡äºé¢‘ç¹çš„æ›´æ–°</p>

          <div class="demo-container">
            <div id="box4" class="demo-box" style="width: 200px">å¿«é€Ÿè°ƒæ•´å¤§å°</div>
          </div>

          <input id="width4" type="range" value="200" min="100" max="400" style="width: 100%; margin: 20px 0" />

          <div class="info-panel">
            <h4>æ€§èƒ½ç»Ÿè®¡</h4>
            <div class="info-row">
              <span class="info-label">å®é™…è§¦å‘æ¬¡æ•°:</span>
              <span id="val4-actual" class="info-value">0</span>
            </div>
            <div class="info-row">
              <span class="info-label">throttle åæ‰§è¡Œ:</span>
              <span id="val4-throttled" class="info-value">0</span>
            </div>
            <div class="info-row">
              <span class="info-label">ä¼˜åŒ–ç‡:</span>
              <span id="val4-saved" class="info-value">0%</span>
            </div>
          </div>

          <div class="note">
            <h4>âš ï¸ æ³¨æ„</h4>
            <p>
              è™½ç„¶ResizeObserveræœ¬èº«å·²ç»ç»è¿‡ä¼˜åŒ–ï¼Œä½†åœ¨å›è°ƒä¸­æ‰§è¡Œå¤æ‚æ“ä½œæ—¶ï¼Œä»å»ºè®®ä½¿ç”¨ throttle æˆ– debounce æ¥æå‡æ€§èƒ½ã€‚
            </p>
          </div>
        </section>

        <section class="section">
          <h2>æµè§ˆå™¨å…¼å®¹æ€§</h2>
          <table class="compatibility-table">
            <thead>
              <tr>
                <th>API</th>
                <th>Chrome</th>
                <th>Firefox</th>
                <th>Safari</th>
                <th>Edge</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>ResizeObserver</td>
                <td class="supported">âœ“ 64+</td>
                <td class="supported">âœ“ 69+</td>
                <td class="supported">âœ“ 13.1+</td>
                <td class="supported">âœ“ 79+</td>
              </tr>
              <tr>
                <td>borderBoxSize</td>
                <td class="supported">âœ“ 84+</td>
                <td class="partial">éƒ¨åˆ†æ”¯æŒ</td>
                <td class="not-supported">âœ—</td>
                <td class="supported">âœ“ 84+</td>
              </tr>
            </tbody>
          </table>

          <div class="note">
            <h4>ğŸ’¡ Polyfill</h4>
            <p>
              å¯¹äºä¸æ”¯æŒçš„æµè§ˆå™¨ï¼Œå¯ä»¥ä½¿ç”¨
              <a
                href="https://github.com/que-etc/resize-observer-polyfill"
                target="_blank"
                style="color: var(--primary)"
                >ResizeObserver polyfill</a
              >
            </p>
          </div>
        </section>

        <section class="section">
          <h2>æ€»ç»“</h2>
          <ul>
            <li><strong>ç²¾ç¡®ç›‘å¬</strong>ï¼šå¯ä»¥ç›‘å¬ä»»æ„å…ƒç´ çš„å°ºå¯¸å˜åŒ–</li>
            <li><strong>é«˜æ€§èƒ½</strong>ï¼šç›¸æ¯”è½®è¯¢æˆ–å…¶ä»–æ–¹æ³•ï¼Œæ€§èƒ½æ›´å¥½</li>
            <li><strong>å†…å®¹åŒºåŸŸ</strong>ï¼šcontentRect è¿”å›å…ƒç´ çš„ content-box å°ºå¯¸</li>
            <li><strong>å¸¸ç”¨åœºæ™¯</strong>ï¼šå“åº”å¼ç»„ä»¶ã€è‡ªé€‚åº”å¸ƒå±€ã€Canvas é‡ç»˜ç­‰</li>
            <li><strong>æ³¨æ„äº‹é¡¹</strong>ï¼šé¿å…åœ¨å›è°ƒä¸­è§¦å‘æ–°çš„å°ºå¯¸å˜åŒ–ï¼Œé˜²æ­¢æ— é™å¾ªç¯</li>
          </ul>
        </section>
      </div>
    </main>

    <script>
      // ç¤ºä¾‹ 1ï¼šåŸºç¡€ç”¨æ³•
      const box1 = document.getElementById('box1');
      const width1 = document.getElementById('width1');
      const height1 = document.getElementById('height1');
      let count1 = 0;

      const observer1 = new ResizeObserver((entries) => {
        for (const entry of entries) {
          count1++;
          document.getElementById('val1-width').textContent = Math.round(entry.contentRect.width) + 'px';
          document.getElementById('val1-height').textContent = Math.round(entry.contentRect.height) + 'px';
          document.getElementById('val1-count').textContent = count1;
        }
      });

      observer1.observe(box1);

      width1.addEventListener('input', () => {
        document.getElementById('width1-val').textContent = width1.value;
        box1.style.width = width1.value + 'px';
      });

      height1.addEventListener('input', () => {
        document.getElementById('height1-val').textContent = height1.value;
        box1.style.height = height1.value + 'px';
      });

      // ç¤ºä¾‹ 2ï¼šå“åº”å¼ç»„ä»¶
      const container2 = document.getElementById('container2');
      const width2 = document.getElementById('width2');

      const observer2 = new ResizeObserver((entries) => {
        for (const entry of entries) {
          const width = Math.round(entry.contentRect.width);
          document.getElementById('container-width').textContent = width + 'px';

          let mode;
          if (width < 400) {
            mode = 'ç´§å‡‘æ¨¡å¼';
          } else if (width < 500) {
            mode = 'æ ‡å‡†æ¨¡å¼';
          } else {
            mode = 'å®½å±æ¨¡å¼';
          }
          document.getElementById('layout-mode').textContent = mode;
        }
      });

      observer2.observe(container2);

      width2.addEventListener('input', () => {
        container2.style.maxWidth = width2.value + 'px';
      });

      // ç¤ºä¾‹ 3ï¼šå¤šä¸ªå…ƒç´ 
      const observer3 = new ResizeObserver((entries) => {
        for (const entry of entries) {
          const width = Math.round(entry.contentRect.width);
          const height = Math.round(entry.contentRect.height);
          const time = new Date().toLocaleTimeString();
          const log = document.getElementById('log3');
          log.innerHTML = `<p>[${time}] ${entry.target.id}: ${width} Ã— ${height}</p>` + log.innerHTML;
        }
      });

      ['box3a', 'box3b', 'box3c'].forEach((id) => {
        observer3.observe(document.getElementById(id));
      });

      document.querySelectorAll('.size-control').forEach((input) => {
        input.addEventListener('input', () => {
          const target = document.getElementById(input.dataset.target);
          target.style.height = input.value + 'px';
        });
      });

      // ç¤ºä¾‹ 4ï¼šthrottle
      const box4 = document.getElementById('box4');
      const width4 = document.getElementById('width4');
      let actualCount4 = 0;
      let throttledCount4 = 0;
      let throttleTimer = null;

      const observer4 = new ResizeObserver((_entries) => {
        actualCount4++;
        document.getElementById('val4-actual').textContent = actualCount4;

        // Throttle: 100ms å†…åªæ‰§è¡Œä¸€æ¬¡
        if (!throttleTimer) {
          throttleTimer = setTimeout(() => {
            throttledCount4++;
            document.getElementById('val4-throttled').textContent = throttledCount4;

            const saved = ((1 - throttledCount4 / actualCount4) * 100).toFixed(1);
            document.getElementById('val4-saved').textContent = saved + '%';

            throttleTimer = null;
          }, 100);
        }
      });

      observer4.observe(box4);

      width4.addEventListener('input', () => {
        box4.style.width = width4.value + 'px';
      });
    </script>
  </body>
</html>
