<!doctype html>
<html data-theme="light" lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ‹–æ‹½å…ƒç´  - DOM å…ƒç´ å°ºå¯¸å’Œä½ç½® API å®æˆ˜æ¡ˆä¾‹</title>
    <link href="../styles.css" rel="stylesheet" />
    <script type="module" src="/src/theme-sync.js"></script>
    <style>
      .draggable {
        width: 150px;
        height: 150px;
        background: var(--primary);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: var(--radius-md);
        cursor: move;
        user-select: none;
        position: absolute;
        box-shadow: var(--shadow-lg);
        font-weight: 600;
      }

      .draggable:active {
        cursor: grabbing;
      }

      .draggable.dragging {
        opacity: 0.8;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      }

      .drop-zone {
        width: 100%;
        height: 100%;
        border: 3px dashed var(--border-color);
        border-radius: var(--radius-lg);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--text-secondary);
        font-weight: 500;
        background: var(--bg-secondary);
      }

      .drop-zone.highlight {
        border-color: var(--primary);
        background: var(--primary-light);
      }
    </style>
  </head>
  <body>
    <aside class="sidebar">
      <div class="sidebar-header">
        <h1>DOM å…ƒç´ å°ºå¯¸å’Œä½ç½® API</h1>
        <a class="back-home" href="../index.html">â† è¿”å›ä¸»é¡µ</a>
      </div>
      <nav class="sidebar-nav">
        <div class="nav-section">
          <h3>åŸºç¡€å±æ€§</h3>
          <a class="nav-item" href="../demos/offset.html">offset* å±æ€§</a>
          <a class="nav-item" href="../demos/client.html">client* å±æ€§</a>
          <a class="nav-item" href="../demos/scroll.html">scroll* å±æ€§</a>
          <a class="nav-item" href="../demos/offset-parent.html">offsetParent</a>
        </div>

        <div class="nav-section">
          <h3>æ ¸å¿ƒ API</h3>
          <a class="nav-item" href="../demos/bounding-rect.html">getBoundingClientRect()</a>
          <a class="nav-item" href="../demos/scroll-into-view.html">scrollIntoView()</a>
        </div>

        <div class="nav-section">
          <h3>ç°ä»£ Observer API</h3>
          <a class="nav-item" href="../demos/resize-observer.html">ResizeObserver</a>
          <a class="nav-item" href="../demos/intersection-observer.html">IntersectionObserver</a>
        </div>

        <div class="nav-section">
          <h3>å®æˆ˜åº”ç”¨</h3>
          <a class="nav-item active" href="drag-drop.html">æ‹–æ‹½å…ƒç´ </a>
          <a class="nav-item" href="snap-align.html">å…ƒç´ å¸é™„å¯¹é½</a>
          <a class="nav-item" href="tooltip.html">å·¥å…·æç¤ºå®šä½</a>
          <a class="nav-item" href="dropdown.html">ä¸‹æ‹‰èœå•å®šä½</a>
          <a class="nav-item" href="modal-center.html">æ¨¡æ€æ¡†å±…ä¸­</a>
          <a class="nav-item" href="scroll-progress.html">æ»šåŠ¨è¿›åº¦æ¡</a>
        </div>
      </nav>
    </aside>

    <main class="main-content">
      <div class="demo-page">
        <h1>æ‹–æ‹½å…ƒç´ </h1>
        <p class="subtitle">ç»“åˆé¼ æ ‡äº‹ä»¶å’Œä½ç½® API å®ç°å¯æ‹–æ‹½å…ƒç´ </p>

        <section class="section">
          <h2>å®ç°åŸç†</h2>
          <p>
            ä½¿ç”¨ <span class="highlight">mousedown</span>ã€<span class="highlight">mousemove</span>ã€<span
              class="highlight"
              >mouseup</span
            >
            äº‹ä»¶ç»“åˆ <code>getBoundingClientRect()</code> å®ç°æ‹–æ‹½åŠŸèƒ½ã€‚
          </p>

          <pre class="code-block"><code><span class="keyword">let</span> isDragging = <span class="value">false</span>;
<span class="keyword">let</span> startX, startY, initialX, initialY;

element.<span class="function">addEventListener</span>(<span class="string">'mousedown'</span>, (e) => {
  isDragging = <span class="value">true</span>;
  startX = e.clientX;
  startY = e.clientY;

  <span class="keyword">const</span> rect = element.<span class="function">getBoundingClientRect</span>();
  initialX = rect.left;
  initialY = rect.top;

  element.classList.<span class="function">add</span>(<span class="string">'dragging'</span>);
});

document.<span class="function">addEventListener</span>(<span class="string">'mousemove'</span>, (e) => {
  <span class="keyword">if</span> (!isDragging) <span class="keyword">return</span>;

  <span class="keyword">const</span> dx = e.clientX - startX;
  <span class="keyword">const</span> dy = e.clientY - startY;

  element.style.left = (initialX + dx) + <span class="string">'px'</span>;
  element.style.top = (initialY + dy) + <span class="string">'px'</span>;
});

document.<span class="function">addEventListener</span>(<span class="string">'mouseup'</span>, () => {
  isDragging = <span class="value">false</span>;
  element.classList.<span class="function">remove</span>(<span class="string">'dragging'</span>);
});</code></pre>
        </section>

        <section class="section">
          <h2>ç¤ºä¾‹ 1ï¼šåŸºç¡€æ‹–æ‹½</h2>
          <p>åœ¨ä¸‹æ–¹åŒºåŸŸæ‹–åŠ¨å…ƒç´ </p>

          <div class="demo-container" style="position: relative; height: 400px">
            <div id="drag1" class="draggable" style="left: 50px; top: 50px">æ‹–åŠ¨æˆ‘</div>
          </div>

          <div class="info-panel">
            <h4>å®æ—¶ä½ç½®</h4>
            <div class="info-row">
              <span class="info-label">X:</span>
              <span id="val1-x" class="info-value">50px</span>
            </div>
            <div class="info-row">
              <span class="info-label">Y:</span>
              <span id="val1-y" class="info-value">50px</span>
            </div>
          </div>

          <button class="control-button secondary" onclick="resetDrag1()">é‡ç½®ä½ç½®</button>
        </section>

        <section class="section">
          <h2>ç¤ºä¾‹ 2ï¼šé™åˆ¶æ‹–æ‹½èŒƒå›´</h2>
          <p>å…ƒç´ åªèƒ½åœ¨å®¹å™¨å†…ç§»åŠ¨</p>

          <div
            id="container2"
            class="demo-container"
            style="position: relative; height: 400px; border: 3px solid var(--border-color)"
          >
            <div id="drag2" class="draggable" style="left: 50px; top: 50px; background: #3b82f6">é™åˆ¶èŒƒå›´</div>
          </div>

          <div class="tip">
            <h4>ğŸ’¡ å…³é”®ç‚¹</h4>
            <p>
              è®¡ç®—è¾¹ç•Œæ—¶ï¼Œéœ€è¦è€ƒè™‘å…ƒç´ è‡ªèº«çš„å®½é«˜ã€‚<br />
              æœ€å° X = 0ï¼Œæœ€å¤§ X = å®¹å™¨å®½åº¦ - å…ƒç´ å®½åº¦
            </p>
          </div>

          <pre class="code-block"><code><span class="keyword">const</span> containerWidth = container.offsetWidth;
<span class="keyword">const</span> elementWidth = element.offsetWidth;
<span class="keyword">const</span> maxX = containerWidth - elementWidth;
<span class="keyword">const</span> maxY = containerHeight - elementHeight;

<span class="comment">// é™åˆ¶ä½ç½®</span>
x = Math.<span class="function">max</span>(<span class="value">0</span>, Math.<span class="function">min</span>(x, maxX));
y = Math.<span class="function">max</span>(<span class="value">0</span>, Math.<span class="function">min</span>(y, maxY));</code></pre>
        </section>

        <section class="section">
          <h2>æ€»ç»“</h2>
          <ul>
            <li>ä½¿ç”¨ mousedown è®°å½•åˆå§‹ä½ç½®å’Œé¼ æ ‡ä½ç½®</li>
            <li>mousemove æ—¶è®¡ç®—ä½ç§»å¹¶æ›´æ–°å…ƒç´ ä½ç½®</li>
            <li>mouseup æ¸…é™¤æ‹–æ‹½çŠ¶æ€</li>
            <li>ä½¿ç”¨ getBoundingClientRect() è·å–ç²¾ç¡®ä½ç½®</li>
            <li>æ³¨æ„è¾¹ç•Œæ£€æµ‹ï¼Œé˜²æ­¢å…ƒç´ ç§»å‡ºå®¹å™¨</li>
          </ul>
        </section>
      </div>
    </main>

    <script>
      // ç¤ºä¾‹ 1ï¼šåŸºç¡€æ‹–æ‹½
      const drag1 = document.getElementById('drag1');
      let isDragging1 = false;
      let startX1, startY1, initialX1, initialY1;

      drag1.addEventListener('mousedown', (e) => {
        isDragging1 = true;
        startX1 = e.clientX;
        startY1 = e.clientY;

        const rect = drag1.getBoundingClientRect();
        initialX1 = rect.left;
        initialY1 = rect.top;

        drag1.classList.add('dragging');
      });

      document.addEventListener('mousemove', (e) => {
        if (!isDragging1) {
          return;
        }

        const dx = e.clientX - startX1;
        const dy = e.clientY - startY1;

        const newX = initialX1 + dx;
        const newY = initialY1 + dy;

        drag1.style.left = newX + 'px';
        drag1.style.top = newY + 'px';

        document.getElementById('val1-x').textContent = Math.round(newX) + 'px';
        document.getElementById('val1-y').textContent = Math.round(newY) + 'px';
      });

      document.addEventListener('mouseup', () => {
        if (isDragging1) {
          isDragging1 = false;
          drag1.classList.remove('dragging');
        }
      });

      window.resetDrag1 = function () {
        drag1.style.left = '50px';
        drag1.style.top = '50px';
        document.getElementById('val1-x').textContent = '50px';
        document.getElementById('val1-y').textContent = '50px';
      };

      // ç¤ºä¾‹ 2ï¼šé™åˆ¶èŒƒå›´
      const drag2 = document.getElementById('drag2');
      const container2 = document.getElementById('container2');
      let isDragging2 = false;
      let startX2, startY2, initialX2, initialY2;

      drag2.addEventListener('mousedown', (e) => {
        isDragging2 = true;
        startX2 = e.clientX;
        startY2 = e.clientY;

        const rect = drag2.getBoundingClientRect();
        const containerRect = container2.getBoundingClientRect();
        initialX2 = rect.left - containerRect.left;
        initialY2 = rect.top - containerRect.top;

        drag2.classList.add('dragging');
      });

      document.addEventListener('mousemove', (e) => {
        if (!isDragging2) {
          return;
        }

        const dx = e.clientX - startX2;
        const dy = e.clientY - startY2;

        let newX = initialX2 + dx;
        let newY = initialY2 + dy;

        // é™åˆ¶èŒƒå›´
        const maxX = container2.offsetWidth - drag2.offsetWidth;
        const maxY = container2.offsetHeight - drag2.offsetHeight;

        newX = Math.max(0, Math.min(newX, maxX));
        newY = Math.max(0, Math.min(newY, maxY));

        drag2.style.left = newX + 'px';
        drag2.style.top = newY + 'px';
      });

      document.addEventListener('mouseup', () => {
        if (isDragging2) {
          isDragging2 = false;
          drag2.classList.remove('dragging');
        }
      });
    </script>
  </body>
</html>
