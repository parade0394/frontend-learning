<!doctype html>
<html data-theme="light" lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å…ƒç´ å¸é™„å¯¹é½ - DOM å…ƒç´ å°ºå¯¸å’Œä½ç½® API å®æˆ˜æ¡ˆä¾‹</title>
    <link href="../styles.css" rel="stylesheet" />
    <script type="module" src="/src/theme-sync.js"></script>
    <style>
      .snap-grid {
        position: absolute;
        width: 100%;
        height: 100%;
        background-image:
          linear-gradient(to right, var(--border-color) 1px, transparent 1px),
          linear-gradient(to bottom, var(--border-color) 1px, transparent 1px);
        background-size: 50px 50px;
        opacity: 0.3;
        pointer-events: none;
      }

      .snap-box {
        width: 150px;
        height: 100px;
        background: var(--primary);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: var(--radius-md);
        position: absolute;
        cursor: move;
        user-select: none;
        font-weight: 600;
      }

      .snap-guide {
        position: absolute;
        background: #ef4444;
        pointer-events: none;
        z-index: 100;
      }

      .snap-guide.horizontal {
        height: 2px;
        width: 100%;
        left: 0;
      }

      .snap-guide.vertical {
        width: 2px;
        height: 100%;
        top: 0;
      }
    </style>
  </head>
  <body>
    <aside class="sidebar">
      <div class="sidebar-header">
        <h1>DOM å…ƒç´ å°ºå¯¸å’Œä½ç½® API</h1>
        <a class="back-home" href="../index.html">â† è¿”å›ä¸»é¡µ</a>
      </div>
      <nav class="sidebar-nav">
        <div class="nav-section">
          <h3>å®æˆ˜åº”ç”¨</h3>
          <a class="nav-item" href="drag-drop.html">æ‹–æ‹½å…ƒç´ </a>
          <a class="nav-item active" href="snap-align.html">å…ƒç´ å¸é™„å¯¹é½</a>
          <a class="nav-item" href="tooltip.html">å·¥å…·æç¤ºå®šä½</a>
          <a class="nav-item" href="dropdown.html">ä¸‹æ‹‰èœå•å®šä½</a>
          <a class="nav-item" href="modal-center.html">æ¨¡æ€æ¡†å±…ä¸­</a>
          <a class="nav-item" href="scroll-progress.html">æ»šåŠ¨è¿›åº¦æ¡</a>
        </div>
      </nav>
    </aside>

    <main class="main-content">
      <div class="demo-page">
        <h1>å…ƒç´ å¸é™„å¯¹é½</h1>
        <p class="subtitle">å®ç°æ‹–æ‹½æ—¶çš„ç£å¸æ•ˆæœå’Œå¯¹é½è¾…åŠ©çº¿</p>

        <section class="section">
          <h2>å®ç°åŸç†</h2>
          <p>åœ¨æ‹–æ‹½è¿‡ç¨‹ä¸­ï¼Œæ£€æµ‹å…ƒç´ ä¸å…¶ä»–å…ƒç´ çš„å¯¹é½å…³ç³»ã€‚å½“æ¥è¿‘å¯¹é½ä½ç½®æ—¶ï¼ˆå¦‚ 10px ä»¥å†…ï¼‰ï¼Œ è‡ªåŠ¨å¸é™„åˆ°å¯¹é½çº¿ã€‚</p>

          <pre
            class="code-block"
          ><code><span class="keyword">function</span> <span class="function">checkSnap</span>(element, target) {
  <span class="keyword">const</span> snapThreshold = <span class="value">10</span>;

  <span class="keyword">const</span> elemRect = element.<span class="function">getBoundingClientRect</span>();
  <span class="keyword">const</span> targetRect = target.<span class="function">getBoundingClientRect</span>();

  <span class="comment">// æ£€æŸ¥å·¦è¾¹ç¼˜å¯¹é½</span>
  <span class="keyword">if</span> (Math.<span class="function">abs</span>(elemRect.left - targetRect.left) &lt; snapThreshold) {
    <span class="comment">// å¸é™„åˆ°å·¦è¾¹ç¼˜</span>
    <span class="keyword">return</span> { snap: <span class="value">true</span>, value: targetRect.left };
  }

  <span class="comment">// æ£€æŸ¥å³è¾¹ç¼˜å¯¹é½</span>
  <span class="keyword">if</span> (Math.<span class="function">abs</span>(elemRect.right - targetRect.right) &lt; snapThreshold) {
    <span class="keyword">return</span> { snap: <span class="value">true</span>, value: targetRect.right - elemRect.width };
  }

  <span class="keyword">return</span> { snap: <span class="value">false</span> };
}</code></pre>
        </section>

        <section class="section">
          <h2>ç¤ºä¾‹ï¼šç½‘æ ¼å¸é™„</h2>
          <p>æ‹–æ‹½å…ƒç´ ä¼šè‡ªåŠ¨å¸é™„åˆ° 50px ç½‘æ ¼</p>

          <div class="demo-container" style="position: relative; height: 400px">
            <div class="snap-grid"></div>
            <div id="snap1" class="snap-box" style="left: 0; top: 0">æ‹–åŠ¨æˆ‘</div>
            <div id="guide-h" class="snap-guide" style="display: none"></div>
            <div id="guide-v" class="snap-guide" style="display: none"></div>
          </div>

          <div class="info-panel">
            <h4>å½“å‰ä½ç½®</h4>
            <div class="info-row">
              <span class="info-label">X (å·²å¸é™„):</span>
              <span id="snap-x" class="info-value">0px</span>
            </div>
            <div class="info-row">
              <span class="info-label">Y (å·²å¸é™„):</span>
              <span id="snap-y" class="info-value">0px</span>
            </div>
          </div>

          <div class="tip">
            <h4>ğŸ’¡ å¸é™„è®¡ç®—</h4>
            <p>
              å¸é™„ä½ç½® = Math.round(åŸå§‹ä½ç½® / ç½‘æ ¼å¤§å°) * ç½‘æ ¼å¤§å°<br />
              è¿™æ ·å…ƒç´ å°±ä¼šè‡ªåŠ¨å¯¹é½åˆ°æœ€è¿‘çš„ç½‘æ ¼çº¿
            </p>
          </div>
        </section>

        <section class="section">
          <h2>æ€»ç»“</h2>
          <ul>
            <li>å®šä¹‰å¸é™„é˜ˆå€¼ï¼ˆå¦‚ 10pxï¼‰</li>
            <li>åœ¨æ‹–æ‹½è¿‡ç¨‹ä¸­æŒç»­æ£€æµ‹å¯¹é½å…³ç³»</li>
            <li>æ˜¾ç¤ºè¾…åŠ©çº¿æç¤ºå¯¹é½ä½ç½®</li>
            <li>è‡ªåŠ¨è°ƒæ•´å…ƒç´ ä½ç½®åˆ°å¯¹é½ç‚¹</li>
            <li>æå‡ç”¨æˆ·ä½“éªŒå’Œç²¾ç¡®åº¦</li>
          </ul>
        </section>
      </div>
    </main>

    <script>
      const snap1 = document.getElementById('snap1');
      const guideH = document.getElementById('guide-h');
      const guideV = document.getElementById('guide-v');
      const gridSize = 50;

      let isDragging = false;
      let startX, startY, initialX, initialY;

      snap1.addEventListener('mousedown', (e) => {
        isDragging = true;
        startX = e.clientX;
        startY = e.clientY;

        const rect = snap1.getBoundingClientRect();
        const containerRect = snap1.parentElement.getBoundingClientRect();
        initialX = rect.left - containerRect.left;
        initialY = rect.top - containerRect.top;

        snap1.style.cursor = 'grabbing';
      });

      document.addEventListener('mousemove', (e) => {
        if (!isDragging) {
          return;
        }

        const dx = e.clientX - startX;
        const dy = e.clientY - startY;

        const newX = initialX + dx;
        const newY = initialY + dy;

        // å¸é™„åˆ°ç½‘æ ¼
        const snappedX = Math.round(newX / gridSize) * gridSize;
        const snappedY = Math.round(newY / gridSize) * gridSize;

        snap1.style.left = snappedX + 'px';
        snap1.style.top = snappedY + 'px';

        document.getElementById('snap-x').textContent = snappedX + 'px';
        document.getElementById('snap-y').textContent = snappedY + 'px';

        // æ˜¾ç¤ºå¯¹é½çº¿
        guideH.style.display = 'block';
        guideH.style.top = snappedY + snap1.offsetHeight / 2 + 'px';

        guideV.style.display = 'block';
        guideV.style.left = snappedX + snap1.offsetWidth / 2 + 'px';
      });

      document.addEventListener('mouseup', () => {
        if (isDragging) {
          isDragging = false;
          snap1.style.cursor = 'move';
          guideH.style.display = 'none';
          guideV.style.display = 'none';
        }
      });
    </script>
  </body>
</html>
