<!doctype html>
<html data-theme="light" lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ä¸‹æ‹‰èœå•å®šä½ - DOM å…ƒç´ å°ºå¯¸å’Œä½ç½® API å®æˆ˜æ¡ˆä¾‹</title>
    <link href="../styles.css" rel="stylesheet" />
    <script type="module" src="/src/theme-sync.js"></script>
    <style>
      .dropdown-container {
        position: relative;
        display: inline-block;
      }

      .dropdown-trigger {
        padding: 12px 24px;
        background: var(--primary);
        color: white;
        border: none;
        border-radius: var(--radius-md);
        cursor: pointer;
        font-weight: 600;
        font-size: 1rem;
      }

      .dropdown-menu {
        position: fixed;
        background: white;
        border: 2px solid var(--border-color);
        border-radius: var(--radius-md);
        box-shadow: var(--shadow-lg);
        min-width: 200px;
        z-index: 1000;
        display: none;
        overflow: hidden;
      }

      .dropdown-menu.visible {
        display: block;
      }

      .dropdown-item {
        padding: 12px 16px;
        cursor: pointer;
        transition: background 0.2s ease;
        color: var(--text-primary);
        border-bottom: 1px solid var(--bg-secondary);
      }

      .dropdown-item:hover {
        background: var(--primary-light);
        color: var(--primary);
      }

      .dropdown-item:last-child {
        border-bottom: none;
      }
    </style>
  </head>
  <body>
    <aside class="sidebar">
      <div class="sidebar-header">
        <h1>DOM å…ƒç´ å°ºå¯¸å’Œä½ç½® API</h1>
        <a class="back-home" href="../index.html">â† è¿”å›ä¸»é¡µ</a>
      </div>
      <nav class="sidebar-nav">
        <div class="nav-section">
          <h3>å®æˆ˜åº”ç”¨</h3>
          <a class="nav-item" href="drag-drop.html">æ‹–æ‹½å…ƒç´ </a>
          <a class="nav-item" href="snap-align.html">å…ƒç´ å¸é™„å¯¹é½</a>
          <a class="nav-item" href="tooltip.html">å·¥å…·æç¤ºå®šä½</a>
          <a class="nav-item active" href="dropdown.html">ä¸‹æ‹‰èœå•å®šä½</a>
          <a class="nav-item" href="modal-center.html">æ¨¡æ€æ¡†å±…ä¸­</a>
          <a class="nav-item" href="scroll-progress.html">æ»šåŠ¨è¿›åº¦æ¡</a>
        </div>
      </nav>
    </aside>

    <main class="main-content">
      <div class="demo-page">
        <h1>ä¸‹æ‹‰èœå•å®šä½</h1>
        <p class="subtitle">è®¡ç®—ä¸‹æ‹‰èœå•çš„æœ€ä½³ä½ç½®ï¼Œå¤„ç†è¾¹ç•Œæƒ…å†µ</p>

        <section class="section">
          <h2>å®ç°åŸç†</h2>
          <p>ä¸‹æ‹‰èœå•éœ€è¦æ ¹æ®è§¦å‘æŒ‰é’®çš„ä½ç½®æ™ºèƒ½å®šä½ï¼Œç¡®ä¿èœå•å®Œæ•´æ˜¾ç¤ºåœ¨è§†å£å†…ã€‚</p>

          <pre
            class="code-block"
          ><code><span class="keyword">function</span> <span class="function">positionDropdown</span>(trigger, menu) {
  <span class="keyword">const</span> triggerRect = trigger.<span class="function">getBoundingClientRect</span>();
  <span class="keyword">const</span> menuRect = menu.<span class="function">getBoundingClientRect</span>();

  <span class="comment">// é»˜è®¤ï¼šå·¦ä¸Šè§’å¯¹é½ï¼Œæ˜¾ç¤ºåœ¨æŒ‰é’®ä¸‹æ–¹</span>
  <span class="keyword">let</span> top = triggerRect.bottom + <span class="value">5</span>;
  <span class="keyword">let</span> left = triggerRect.left;

  <span class="comment">// æ£€æŸ¥æ˜¯å¦è¶…å‡ºåº•éƒ¨</span>
  <span class="keyword">if</span> (top + menuRect.height &gt; window.innerHeight) {
    <span class="comment">// æ”¹ä¸ºæ˜¾ç¤ºåœ¨æŒ‰é’®ä¸Šæ–¹</span>
    top = triggerRect.top - menuRect.height - <span class="value">5</span>;
  }

  <span class="comment">// æ£€æŸ¥æ˜¯å¦è¶…å‡ºå³è¾¹ç•Œ</span>
  <span class="keyword">if</span> (left + menuRect.width &gt; window.innerWidth) {
    <span class="comment">// å³å¯¹é½</span>
    left = triggerRect.right - menuRect.width;
  }

  <span class="comment">// æ£€æŸ¥æ˜¯å¦è¶…å‡ºå·¦è¾¹ç•Œ</span>
  <span class="keyword">if</span> (left &lt; <span class="value">0</span>) {
    left = <span class="value">10</span>;
  }

  menu.style.top = top + <span class="string">'px'</span>;
  menu.style.left = left + <span class="string">'px'</span>;
}</code></pre>
        </section>

        <section class="section">
          <h2>ç¤ºä¾‹ï¼šæ™ºèƒ½ä¸‹æ‹‰èœå•</h2>
          <p>ç‚¹å‡»æŒ‰é’®æ‰“å¼€ä¸‹æ‹‰èœå•ï¼ˆä¼šè‡ªåŠ¨é¿å¼€è¾¹ç•Œï¼‰</p>

          <div class="demo-container" style="height: 350px">
            <div style="display: flex; gap: 20px; justify-content: center; align-items: center; height: 100%">
              <div class="dropdown-container">
                <button class="dropdown-trigger" onclick="toggleDropdown('dropdown1')">å·¦ä¾§èœå•</button>
                <div id="dropdown1" class="dropdown-menu">
                  <div class="dropdown-item">é€‰é¡¹ 1</div>
                  <div class="dropdown-item">é€‰é¡¹ 2</div>
                  <div class="dropdown-item">é€‰é¡¹ 3</div>
                </div>
              </div>

              <div class="dropdown-container">
                <button class="dropdown-trigger" onclick="toggleDropdown('dropdown2')">ä¸­é—´èœå•</button>
                <div id="dropdown2" class="dropdown-menu">
                  <div class="dropdown-item">é€‰é¡¹ A</div>
                  <div class="dropdown-item">é€‰é¡¹ B</div>
                  <div class="dropdown-item">é€‰é¡¹ C</div>
                </div>
              </div>

              <div class="dropdown-container">
                <button class="dropdown-trigger" onclick="toggleDropdown('dropdown3')">å³ä¾§èœå•</button>
                <div id="dropdown3" class="dropdown-menu">
                  <div class="dropdown-item">é€‰é¡¹ X</div>
                  <div class="dropdown-item">é€‰é¡¹ Y</div>
                  <div class="dropdown-item">é€‰é¡¹ Z</div>
                </div>
              </div>
            </div>
          </div>

          <div class="tip">
            <h4>ğŸ’¡ å…³é”®ç‚¹</h4>
            <p>
              ä¸‹æ‹‰èœå•ä¼šï¼š<br />
              1. é»˜è®¤æ˜¾ç¤ºåœ¨æŒ‰é’®ä¸‹æ–¹<br />
              2. å¦‚æœä¸‹æ–¹ç©ºé—´ä¸è¶³ï¼Œæ˜¾ç¤ºåœ¨ä¸Šæ–¹<br />
              3. é˜²æ­¢è¶…å‡ºå·¦å³è¾¹ç•Œ<br />
              4. ä½¿ç”¨ fixed å®šä½é¿å…è¢«çˆ¶å®¹å™¨è£å‰ª
            </p>
          </div>
        </section>

        <section class="section">
          <h2>æ€»ç»“</h2>
          <ul>
            <li>ä½¿ç”¨ getBoundingClientRect() è·å–æŒ‰é’®ä½ç½®</li>
            <li>è®¡ç®—èœå•çš„åˆå§‹ä½ç½®</li>
            <li>æ£€æµ‹å››ä¸ªæ–¹å‘çš„è¾¹ç•Œ</li>
            <li>åŠ¨æ€è°ƒæ•´èœå•ä½ç½®å’Œæ–¹å‘</li>
            <li>ç¡®ä¿èœå•å§‹ç»ˆåœ¨è§†å£å†…å¯è§</li>
          </ul>
        </section>
      </div>
    </main>

    <script>
      let currentDropdown = null;

      window.toggleDropdown = function (id) {
        const menu = document.getElementById(id);

        // å…³é—­å…¶ä»–èœå•
        if (currentDropdown && currentDropdown !== menu) {
          currentDropdown.classList.remove('visible');
        }

        // åˆ‡æ¢å½“å‰èœå•
        menu.classList.toggle('visible');

        if (menu.classList.contains('visible')) {
          currentDropdown = menu;
          positionDropdown(menu.previousElementSibling, menu);
        } else {
          currentDropdown = null;
        }
      };

      function positionDropdown(trigger, menu) {
        const triggerRect = trigger.getBoundingClientRect();
        const menuHeight = menu.offsetHeight || 120;
        const menuWidth = menu.offsetWidth || 200;

        // é»˜è®¤ï¼šæ˜¾ç¤ºåœ¨æŒ‰é’®ä¸‹æ–¹ï¼Œå·¦å¯¹é½
        let top = triggerRect.bottom + 5;
        let left = triggerRect.left;

        // æ£€æŸ¥æ˜¯å¦è¶…å‡ºåº•éƒ¨
        if (top + menuHeight > window.innerHeight) {
          // æ”¹ä¸ºæ˜¾ç¤ºåœ¨æŒ‰é’®ä¸Šæ–¹
          top = triggerRect.top - menuHeight - 5;
        }

        // æ£€æŸ¥æ˜¯å¦è¶…å‡ºå³è¾¹ç•Œ
        if (left + menuWidth > window.innerWidth - 10) {
          // å³å¯¹é½
          left = triggerRect.right - menuWidth;
        }

        // æ£€æŸ¥æ˜¯å¦è¶…å‡ºå·¦è¾¹ç•Œ
        if (left < 10) {
          left = 10;
        }

        menu.style.top = top + 'px';
        menu.style.left = left + 'px';
      }

      // ç‚¹å‡»é¡µé¢å…¶ä»–åœ°æ–¹å…³é—­èœå•
      document.addEventListener('click', (e) => {
        if (currentDropdown && !e.target.closest('.dropdown-container')) {
          currentDropdown.classList.remove('visible');
          currentDropdown = null;
        }
      });
    </script>
  </body>
</html>
