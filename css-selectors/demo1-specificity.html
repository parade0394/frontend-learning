<!doctype html>
<html data-theme="light" lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>选择器优先级 - CSS 现代选择器</title>
    <link href="/src/styles/common.css" rel="stylesheet" />
    <link href="styles.css" rel="stylesheet" />
    <script>
      (function () {
        try {
          const theme = localStorage.getItem('themeMode') || 'light';
          const color = localStorage.getItem('primaryColor') || '#10b981';
          let actualTheme = theme;
          if (theme === 'auto') {
            actualTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
          }
          document.documentElement.setAttribute('data-theme', actualTheme);
          document.documentElement.style.setProperty('--primary', color);
        } catch (e) {
          console.log(e);
        }
      })();
    </script>
    <script type="module" src="/src/theme.js"></script>
    <script src="compatibility-check.js"></script>
    <script src="accessibility-enhancements.js"></script>
  </head>
  <body data-demo="specificity">
    <!-- Skip to main content link for accessibility -->
    <a class="skip-link" href="#main-content">跳转到主要内容</a>
    <!-- 左侧边栏导航 -->
    <aside class="sidebar" aria-label="演示导航" role="navigation">
      <div class="sidebar-header">
        <h1>CSS 现代选择器</h1>
        <a class="back-home" href="index.html" aria-label="返回主页">← 返回主页</a>
      </div>
      <nav class="sidebar-nav" aria-label="主导航">
        <div class="nav-section">
          <h3>基础概念</h3>
          <a class="nav-item active" href="demo1-specificity.html">选择器优先级</a>
        </div>
        <div class="nav-section">
          <h3>逻辑选择器</h3>
          <a class="nav-item" href="demo2-is.html">:is() 伪类</a>
          <a class="nav-item" href="demo3-where.html">:where() 伪类</a>
          <a class="nav-item" href="demo4-not.html">:not() 伪类</a>
        </div>
        <div class="nav-section">
          <h3>父子关系选择器</h3>
          <a class="nav-item" href="demo5-has-basics.html">:has() 基础</a>
          <a class="nav-item" href="demo6-has-practical.html">:has() 实战</a>
        </div>
        <div class="nav-section">
          <h3>状态选择器</h3>
          <a class="nav-item" href="demo7-focus-within.html">:focus-within</a>
          <a class="nav-item" href="demo8-focus-visible.html">:focus-visible</a>
        </div>
        <div class="nav-section">
          <h3>结构选择器进阶</h3>
          <a class="nav-item" href="demo9-nth-child.html">:nth-child() 高级</a>
          <a class="nav-item" href="demo10-nth-comparison.html">结构选择器对比</a>
        </div>
        <div class="nav-section">
          <h3>综合实战</h3>
          <a class="nav-item" href="demo11-combinations.html">选择器组合实战</a>
        </div>
      </nav>
    </aside>

    <!-- 右侧主内容区 -->
    <main id="main-content" class="main-content" role="main">
      <div class="demo-page">
        <h1>选择器优先级</h1>
        <p class="subtitle">理解权重计算和 specificity 规则</p>

        <!-- 概念介绍 -->
        <section class="concept-section">
          <h2>什么是选择器优先级？</h2>
          <p>
            CSS
            选择器优先级（Specificity）决定了当多个规则应用于同一元素时，哪个规则会生效。理解优先级是掌握现代选择器的基础。
          </p>
          <p>优先级通常用三位数表示：<strong>(ID数量, 类数量, 标签数量)</strong>。数值越大，优先级越高。</p>
          <ul>
            <li><strong>ID 选择器</strong> - 权重 100 (例如: #header)</li>
            <li><strong>类选择器、属性选择器、伪类</strong> - 权重 10 (例如: .button, [type="text"], :hover)</li>
            <li><strong>标签选择器、伪元素</strong> - 权重 1 (例如: div, ::before)</li>
            <li><strong>通配符、组合符</strong> - 权重 0 (例如: *, >, +)</li>
            <li><strong>!important</strong> - 覆盖所有优先级（应谨慎使用）</li>
          </ul>
        </section>

        <!-- 语法说明 -->
        <section class="syntax-section">
          <h2>优先级计算规则</h2>
          <p style="color: var(--text-secondary); margin-bottom: 20px">
            优先级计算遵循简单的加法规则。将选择器中的 ID、类和标签数量分别相加，得到三位数的权重值。
          </p>
          <pre><code><span class="code-comment">/* 权重计算公式：(ID数量, 类数量, 标签数量) */</span>

<span class="code-comment">/* 权重: (0, 0, 1) = 1 */</span>
p { color: blue; }

<span class="code-comment">/* 权重: (0, 1, 0) = 10 */</span>
.text { color: green; }

<span class="code-comment">/* 权重: (1, 0, 0) = 100 */</span>
#title { color: red; }

<span class="code-comment">/* 权重: (0, 1, 1) = 11 */</span>
p.text { color: purple; }

<span class="code-comment">/* 权重: (1, 1, 1) = 111 */</span>
#title.text p { color: orange; }

<span class="code-comment">/* 权重: (0, 2, 2) = 22 */</span>
div.container p.highlight { color: teal; }

<span class="code-comment">/* 权重: (2, 1, 0) = 210 */</span>
#header #nav .menu { color: navy; }</code></pre>

          <div
            style="
              background: var(--warning-light);
              border-left: 4px solid var(--warning);
              padding: 15px;
              border-radius: var(--radius-md);
              margin-top: 20px;
            "
          >
            <strong style="color: var(--warning-dark)">⚠️ 重要提示：</strong>
            <p style="color: var(--text-primary); margin-top: 8px; line-height: 1.6">
              优先级不是十进制！(0, 1, 0) 不等于 10，而是表示"0个ID + 1个类 + 0个标签"。 11 个类选择器 (0, 11, 0)
              也无法超过 1 个 ID 选择器 (1, 0, 0)。
            </p>
          </div>
        </section>

        <!-- 交互示例 -->
        <section class="demo-section">
          <h2>权重对比示例</h2>

          <h3>示例 1: 基础权重对比</h3>
          <div class="demo-container">
            <div class="demo-preview">
              <div class="demo-preview-title">效果预览</div>
              <style>
                .specificity-demo-1 p {
                  color: #3b82f6;
                }
                .specificity-demo-1 .text-class {
                  color: #10b981;
                }
                .specificity-demo-1 #text-id {
                  color: #ef4444;
                }
              </style>
              <div class="specificity-demo-1">
                <p>
                  标签选择器
                  <span
                    style="
                      background: var(--gray-700);
                      color: white;
                      padding: 2px 8px;
                      border-radius: 4px;
                      font-size: 0.85rem;
                      font-family: var(--font-mono);
                    "
                    >(0,0,1)</span
                  >
                </p>
                <p class="text-class">
                  类选择器
                  <span
                    style="
                      background: var(--gray-700);
                      color: white;
                      padding: 2px 8px;
                      border-radius: 4px;
                      font-size: 0.85rem;
                      font-family: var(--font-mono);
                    "
                    >(0,1,1)</span
                  >
                </p>
                <p id="text-id">
                  ID 选择器
                  <span
                    style="
                      background: var(--gray-700);
                      color: white;
                      padding: 2px 8px;
                      border-radius: 4px;
                      font-size: 0.85rem;
                      font-family: var(--font-mono);
                    "
                    >(1,0,1)</span
                  >
                </p>
              </div>
            </div>
            <div class="demo-code">
              <pre><code><span class="code-comment">/* 权重: (0, 0, 1) = 1 */</span>
p { color: blue; }

<span class="code-comment">/* 权重: (0, 1, 1) = 11 - 覆盖上面的规则 */</span>
.text-class { color: green; }

<span class="code-comment">/* 权重: (1, 0, 1) = 101 - 优先级最高 */</span>
#text-id { color: red; }</code></pre>
            </div>
          </div>

          <h3>示例 2: 复杂选择器权重对比</h3>
          <div class="demo-container">
            <div class="demo-preview">
              <div class="demo-preview-title">效果预览</div>
              <style>
                .specificity-demo-2 .box {
                  padding: 15px;
                  margin: 10px 0;
                  border-radius: 8px;
                  font-weight: 600;
                  border: 2px solid;
                }
                .specificity-demo-2 div.box {
                  background: #dbeafe;
                  color: #1e40af;
                  border-color: #3b82f6;
                }
                .specificity-demo-2 .container .box {
                  background: #d1fae5;
                  color: #065f46;
                  border-color: #10b981;
                }
                .specificity-demo-2 #special-box {
                  background: #fee2e2;
                  color: #991b1b;
                  border-color: #ef4444;
                }
              </style>
              <div class="specificity-demo-2">
                <div class="container">
                  <div class="box">
                    权重 (0,2,0) 胜出 ✓
                    <div style="font-size: 0.85rem; margin-top: 5px; opacity: 0.8">.container .box 覆盖了 div.box</div>
                  </div>
                  <div id="special-box" class="box">
                    权重 (1,0,0) 胜出 ✓
                    <div style="font-size: 0.85rem; margin-top: 5px; opacity: 0.8">#special-box 覆盖了所有类选择器</div>
                  </div>
                </div>
              </div>
            </div>
            <div class="demo-code">
              <pre><code><span class="code-comment">/* 权重: (0, 1, 1) = 11 */</span>
div.box { 
  background: lightblue; 
  color: darkblue; 
}

<span class="code-comment">/* 权重: (0, 2, 0) = 20 - 更高 ✓ */</span>
.container .box { 
  background: lightgreen; 
  color: darkgreen; 
}

<span class="code-comment">/* 权重: (1, 0, 0) = 100 - 最高 ✓ */</span>
#special-box { 
  background: lightcoral; 
  color: darkred; 
}</code></pre>
            </div>
          </div>

          <h3>示例 3: 多个类选择器 vs ID 选择器</h3>
          <div class="demo-container">
            <div class="demo-preview">
              <div class="demo-preview-title">效果预览 - ID 总是胜出</div>
              <style>
                .specificity-demo-3 .a.b.c.d.e.f.g.h.i.j.k {
                  background: #dbeafe;
                  color: #1e40af;
                  padding: 15px;
                  border-radius: 8px;
                  font-weight: 600;
                  border: 2px solid #3b82f6;
                }
                .specificity-demo-3 #winner {
                  background: #fef3c7;
                  color: #92400e;
                  border-color: #f59e0b;
                }
              </style>
              <div class="specificity-demo-3">
                <div id="winner" class="a b c d e f g h i j k">
                  即使有 11 个类，ID 选择器依然胜出！
                  <div style="font-size: 0.85rem; margin-top: 8px; opacity: 0.8">权重: (1,0,0) > (0,11,1)</div>
                </div>
              </div>
            </div>
            <div class="demo-code">
              <pre><code><span class="code-comment">/* 权重: (0, 11, 1) = 0-11-1 */</span>
.a.b.c.d.e.f.g.h.i.j.k { 
  background: lightblue; 
  color: darkblue; 
}

<span class="code-comment">/* 权重: (1, 0, 0) = 1-0-0 */</span>
<span class="code-comment">/* ID 选择器总是胜出！✓ */</span>
#winner { 
  background: lightyellow; 
  color: darkorange; 
}</code></pre>
            </div>
          </div>
        </section>

        <!-- 交互式计算器 -->
        <section class="demo-section">
          <h2>交互式优先级计算器</h2>
          <p style="color: var(--text-secondary); margin-bottom: 20px">输入任意 CSS 选择器，实时计算其优先级权重。</p>

          <div class="interactive-demo">
            <div class="controls">
              <div class="control-group" style="flex: 1; min-width: 300px">
                <label for="selector-input">输入选择器：</label>
                <input
                  id="selector-input"
                  type="text"
                  placeholder="例如: #header .nav li:hover"
                  value="#header .nav li:hover"
                  aria-label="CSS 选择器输入框"
                  aria-describedby="selector-help"
                  style="width: 100%"
                />
                <span id="selector-help" class="sr-only">输入任意 CSS 选择器以计算其优先级权重</span>
              </div>
            </div>

            <div id="specificity-result" class="result-display" aria-live="polite" aria-atomic="true" role="status">
              <div style="font-size: 1.1rem; margin-bottom: 15px; color: var(--primary)">
                <strong>权重计算结果：</strong>
              </div>
              <div id="result-content"></div>
            </div>

            <div
              style="margin-top: 20px; padding: 15px; background: var(--bg-secondary); border-radius: var(--radius-md)"
            >
              <strong style="color: var(--text-primary)">快捷示例：</strong>
              <div
                aria-label="选择器示例"
                style="display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap"
                role="group"
              >
                <button class="example-btn" data-selector="p" aria-label="示例选择器: p">p</button>
                <button class="example-btn" data-selector=".button" aria-label="示例选择器: .button">.button</button>
                <button class="example-btn" data-selector="#header" aria-label="示例选择器: #header">#header</button>
                <button class="example-btn" data-selector="div.container" aria-label="示例选择器: div.container">
                  div.container
                </button>
                <button class="example-btn" data-selector=".nav li a" aria-label="示例选择器: .nav li a">
                  .nav li a
                </button>
                <button class="example-btn" data-selector="#main .content p" aria-label="示例选择器: #main .content p">
                  #main .content p
                </button>
                <button
                  class="example-btn"
                  data-selector="ul li:first-child"
                  aria-label="示例选择器: ul li:first-child"
                >
                  ul li:first-child
                </button>
                <button
                  class="example-btn"
                  data-selector="#header nav.menu a:hover"
                  aria-label="示例选择器: #header nav.menu a:hover"
                >
                  #header nav.menu a:hover
                </button>
              </div>
            </div>
          </div>

          <style>
            .example-btn {
              padding: 8px 16px;
              background: var(--primary-light);
              color: var(--primary-dark);
              border: 2px solid var(--primary);
              border-radius: var(--radius-md);
              font-family: var(--font-mono);
              font-size: 0.9rem;
              cursor: pointer;
              transition: all var(--transition-base);
              font-weight: 600;
            }
            .example-btn:hover {
              background: var(--primary);
              color: white;
              transform: translateY(-2px);
              box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            }
            .specificity-breakdown {
              display: flex;
              gap: 20px;
              margin: 15px 0;
              flex-wrap: wrap;
            }
            .specificity-part {
              padding: 12px 20px;
              background: var(--bg-secondary);
              border-radius: var(--radius-md);
              border: 2px solid var(--border-color);
              text-align: center;
              min-width: 100px;
            }
            .specificity-part .label {
              font-size: 0.85rem;
              color: var(--text-secondary);
              margin-bottom: 5px;
              text-transform: uppercase;
              letter-spacing: 0.05em;
            }
            .specificity-part .value {
              font-size: 1.8rem;
              font-weight: 700;
              color: var(--primary);
              font-family: var(--font-mono);
            }
            .total-weight {
              padding: 15px 25px;
              background: var(--primary);
              color: white;
              border-radius: var(--radius-md);
              text-align: center;
              font-size: 1.2rem;
              font-weight: 700;
              margin-top: 15px;
            }
          </style>

          <script>
            function calculateSpecificity(selector) {
              // 移除空格和特殊字符进行基础清理
              const cleaned = selector.trim();

              if (!cleaned) {
                return { ids: 0, classes: 0, tags: 0, error: '请输入选择器' };
              }

              let ids = 0;
              let classes = 0;
              let tags = 0;

              try {
                // 计算 ID 选择器 (#)
                const idMatches = cleaned.match(/#[a-zA-Z][\w-]*/g);
                ids = idMatches ? idMatches.length : 0;

                // 计算类选择器 (.)
                const classMatches = cleaned.match(/\.[a-zA-Z][\w-]*/g);
                classes = classMatches ? classMatches.length : 0;

                // 计算属性选择器 ([...])
                const attrMatches = cleaned.match(/\[[^\]]+\]/g);
                classes += attrMatches ? attrMatches.length : 0;

                // 计算伪类 (:hover, :focus, etc.) 但不包括伪元素
                const pseudoClassMatches = cleaned.match(/:[a-zA-Z][\w-]*(?!\()/g);
                if (pseudoClassMatches) {
                  // 过滤掉伪元素 (::before, ::after 等)
                  const validPseudoClasses = pseudoClassMatches.filter(
                    (p) => !p.startsWith('::') && !['::before', '::after', '::first-line', '::first-letter'].includes(p)
                  );
                  classes += validPseudoClasses.length;
                }

                // 计算标签选择器
                // 移除 ID、类、属性、伪类后，剩余的单词就是标签
                let remaining = cleaned;
                remaining = remaining.replace(/#[a-zA-Z][\w-]*/g, '');
                remaining = remaining.replace(/\.[a-zA-Z][\w-]*/g, '');
                remaining = remaining.replace(/\[[^\]]+\]/g, '');
                remaining = remaining.replace(/:[a-zA-Z][\w-]*/g, '');
                remaining = remaining.replace(/[>+~\s]/g, ' ');

                const tagMatches = remaining.match(/\b[a-zA-Z][\w-]*\b/g);
                if (tagMatches) {
                  // 过滤掉通配符和组合符
                  const validTags = tagMatches.filter((t) => t !== '*' && t.length > 0);
                  tags = validTags.length;
                }

                return { ids, classes, tags, error: null };
              } catch {
                return { ids: 0, classes: 0, tags: 0, error: '选择器格式错误' };
              }
            }

            function displaySpecificity(selector) {
              const result = calculateSpecificity(selector);
              const resultContent = document.getElementById('result-content');

              if (result.error) {
                resultContent.innerHTML = `
                  <div style="color: var(--error); font-weight: 600;">
                    ❌ ${result.error}
                  </div>
                `;
                return;
              }

              const total = result.ids * 100 + result.classes * 10 + result.tags;

              resultContent.innerHTML = `
                <div style="margin-bottom: 15px;">
                  <strong style="color: var(--text-primary);">选择器：</strong>
                  <code style="background: var(--gray-700); color: var(--gray-200); padding: 4px 12px; border-radius: 4px; font-size: 1rem;">${selector}</code>
                </div>
                
                <div class="specificity-breakdown">
                  <div class="specificity-part">
                    <div class="label">ID 选择器</div>
                    <div class="value">${result.ids}</div>
                  </div>
                  <div class="specificity-part">
                    <div class="label">类/属性/伪类</div>
                    <div class="value">${result.classes}</div>
                  </div>
                  <div class="specificity-part">
                    <div class="label">标签/伪元素</div>
                    <div class="value">${result.tags}</div>
                  </div>
                </div>

                <div class="total-weight">
                  权重表示：(${result.ids}, ${result.classes}, ${result.tags})
                  <div style="margin-top: 5px; font-size: 0.9rem; opacity: 0.9;">
                    数值表示：${total}
                  </div>
                </div>
              `;
            }

            // 初始化
            document.addEventListener('DOMContentLoaded', function () {
              const input = document.getElementById('selector-input');

              // 初始显示
              displaySpecificity(input.value);

              // 实时计算
              input.addEventListener('input', function () {
                displaySpecificity(this.value);
              });

              // 快捷示例按钮
              document.querySelectorAll('.example-btn').forEach((btn) => {
                btn.addEventListener('click', function (_e) {
                  const selector = this.getAttribute('data-selector');
                  input.value = selector;
                  displaySpecificity(selector);
                });
              });
            });
          </script>
        </section>

        <!-- !important 演示 -->
        <section class="demo-section">
          <h2>!important 的作用</h2>
          <p style="color: var(--text-secondary); margin-bottom: 20px">
            <code>!important</code> 会覆盖所有正常的优先级规则，应该谨慎使用。
          </p>

          <h3>示例：!important 覆盖高权重选择器</h3>
          <div class="demo-container">
            <div class="demo-preview">
              <div class="demo-preview-title">效果预览</div>
              <style>
                .important-demo #very-specific-id.with-class {
                  color: #3b82f6;
                  font-weight: 600;
                  padding: 15px;
                  background: #dbeafe;
                  border-radius: 8px;
                  border: 2px solid #3b82f6;
                }
                .important-demo p {
                  color: #dc2626 !important;
                  background: #fee2e2 !important;
                  border-color: #ef4444 !important;
                }
              </style>
              <div class="important-demo">
                <p id="very-specific-id" class="with-class">
                  即使有高权重的 ID 和类选择器，!important 依然胜出
                  <span style="display: block; font-size: 0.85rem; margin-top: 8px; opacity: 0.8">
                    权重 (1,1,1) 被 !important 覆盖
                  </span>
                </p>
              </div>
            </div>
            <div class="demo-code">
              <pre><code><span class="code-comment">/* 权重: (1, 1, 1) = 111 - 非常高 */</span>
#very-specific-id.with-class { 
  color: blue; 
  background: lightblue;
}

<span class="code-comment">/* 权重: (0, 0, 1) = 1 - 很低 */</span>
<span class="code-comment">/* 但是 !important 会覆盖上面的规则 ✓ */</span>
p { 
  color: red !important; 
  background: lightcoral !important;
}</code></pre>
            </div>
          </div>

          <div
            style="
              background: var(--error-light);
              border-left: 4px solid var(--error);
              padding: 20px;
              border-radius: var(--radius-md);
              margin-top: 25px;
            "
          >
            <strong style="color: var(--error-dark); font-size: 1.1rem">⚠️ 使用 !important 的注意事项</strong>
            <ul style="margin-top: 12px; color: var(--text-primary); line-height: 1.8">
              <li><strong>避免滥用：</strong>!important 会破坏 CSS 的层叠规则，使代码难以维护</li>
              <li><strong>调试困难：</strong>过多使用会导致样式覆盖关系混乱</li>
              <li><strong>合理场景：</strong>覆盖第三方库样式、实用工具类（如 .hidden）</li>
              <li><strong>最佳实践：</strong>优先通过提高选择器优先级来解决样式冲突</li>
            </ul>
          </div>
        </section>

        <!-- 兼容性信息 -->
        <section class="compatibility-section">
          <h2>浏览器兼容性</h2>
          <p>CSS 选择器优先级是 CSS 的基础特性，所有现代浏览器都完全支持。</p>
          <table class="compatibility-table">
            <thead>
              <tr>
                <th>浏览器</th>
                <th>支持版本</th>
                <th>状态</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Chrome</td>
                <td>所有版本</td>
                <td class="support-yes">✓ 完全支持</td>
              </tr>
              <tr>
                <td>Firefox</td>
                <td>所有版本</td>
                <td class="support-yes">✓ 完全支持</td>
              </tr>
              <tr>
                <td>Safari</td>
                <td>所有版本</td>
                <td class="support-yes">✓ 完全支持</td>
              </tr>
              <tr>
                <td>Edge</td>
                <td>所有版本</td>
                <td class="support-yes">✓ 完全支持</td>
              </tr>
            </tbody>
          </table>
        </section>
      </div>
    </main>
  </body>
</html>
