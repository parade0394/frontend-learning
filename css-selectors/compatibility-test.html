<!doctype html>
<html data-theme="light" lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æµè§ˆå™¨å…¼å®¹æ€§æ£€æµ‹æµ‹è¯• - CSS ç°ä»£é€‰æ‹©å™¨</title>
    <link href="/src/styles/common.css" rel="stylesheet" />
    <link href="styles.css" rel="stylesheet" />
    <script>
      (function () {
        try {
          const theme = localStorage.getItem('themeMode') || 'light';
          const color = localStorage.getItem('primaryColor') || '#10b981';
          let actualTheme = theme;
          if (theme === 'auto') {
            actualTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
          }
          document.documentElement.setAttribute('data-theme', actualTheme);
          document.documentElement.style.setProperty('--primary', color);
        } catch (e) {
          console.log(e);
        }
      })();
    </script>
    <script type="module" src="/src/theme.js"></script>
    <script src="compatibility-check.js"></script>
  </head>
  <body data-demo="compatibility-test">
    <!-- å·¦ä¾§è¾¹æ å¯¼èˆª -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <h1>CSS ç°ä»£é€‰æ‹©å™¨</h1>
        <a class="back-home" href="index.html">â† è¿”å›ä¸»é¡µ</a>
      </div>
      <nav class="sidebar-nav">
        <div class="nav-section">
          <h3>æµ‹è¯•é¡µé¢</h3>
          <a class="nav-item active" href="compatibility-test.html">å…¼å®¹æ€§æ£€æµ‹æµ‹è¯•</a>
        </div>
      </nav>
    </aside>

    <!-- å³ä¾§ä¸»å†…å®¹åŒº -->
    <main class="main-content">
      <div class="demo-page">
        <h1>æµè§ˆå™¨å…¼å®¹æ€§æ£€æµ‹æµ‹è¯•</h1>
        <p class="subtitle">æµ‹è¯•ç°ä»£ CSS é€‰æ‹©å™¨çš„æµè§ˆå™¨æ”¯æŒæƒ…å†µ</p>

        <!-- æ¦‚å¿µä»‹ç» -->
        <section class="concept-section">
          <h2>å…³äºå…¼å®¹æ€§æ£€æµ‹</h2>
          <p>
            æœ¬é¡µé¢æ¼”ç¤ºäº†æµè§ˆå™¨å…¼å®¹æ€§æ£€æµ‹ç³»ç»Ÿçš„åŠŸèƒ½ã€‚ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹æ‚¨çš„æµè§ˆå™¨æ˜¯å¦æ”¯æŒç°ä»£ CSS é€‰æ‹©å™¨ï¼Œ
            å¹¶åœ¨ä¸æ”¯æŒæ—¶æ˜¾ç¤ºè­¦å‘Šæ¨ªå¹…å’Œé™çº§å»ºè®®ã€‚
          </p>
          <p>æ£€æµ‹ä½¿ç”¨äº† <code>CSS.supports('selector(...)')</code> APIï¼Œè¿™æ˜¯æœ€å¯é çš„ç‰¹æ€§æ£€æµ‹æ–¹æ³•ã€‚</p>
        </section>

        <!-- æ‰‹åŠ¨æ£€æµ‹åŒºåŸŸ -->
        <section class="demo-section">
          <h2>æ‰‹åŠ¨æ£€æµ‹é€‰æ‹©å™¨æ”¯æŒ</h2>
          <p style="color: var(--text-secondary); margin-bottom: 20px">è¾“å…¥ä»»æ„ CSS é€‰æ‹©å™¨ï¼Œæ£€æµ‹æ‚¨çš„æµè§ˆå™¨æ˜¯å¦æ”¯æŒã€‚</p>

          <div class="interactive-demo">
            <div class="controls">
              <div class="control-group" style="flex: 1; min-width: 300px">
                <label for="selector-test-input">è¾“å…¥é€‰æ‹©å™¨ï¼š</label>
                <input
                  id="selector-test-input"
                  type="text"
                  placeholder="ä¾‹å¦‚: :has(*)"
                  value=":has(*)"
                  style="width: 100%"
                />
              </div>
              <div class="control-group">
                <label>&nbsp;</label>
                <button
                  id="test-selector-btn"
                  style="
                    padding: 8px 20px;
                    background: var(--primary);
                    color: white;
                    border: none;
                    border-radius: var(--radius-md);
                    font-weight: 600;
                    cursor: pointer;
                  "
                >
                  æ£€æµ‹
                </button>
              </div>
            </div>

            <div id="test-result" class="result-display">
              <div id="test-result-content">ç‚¹å‡»"æ£€æµ‹"æŒ‰é’®æŸ¥çœ‹ç»“æœ</div>
            </div>

            <div
              style="margin-top: 20px; padding: 15px; background: var(--bg-secondary); border-radius: var(--radius-md)"
            >
              <strong style="color: var(--text-primary)">å¿«æ·æµ‹è¯•ï¼š</strong>
              <div style="display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap">
                <button class="test-example-btn" data-selector=":has(*)">:has(*)</button>
                <button class="test-example-btn" data-selector=":is(div, span)">:is(div, span)</button>
                <button class="test-example-btn" data-selector=":where(div, span)">:where(div, span)</button>
                <button class="test-example-btn" data-selector=":not(.class)">:not(.class)</button>
                <button class="test-example-btn" data-selector=":focus-within">:focus-within</button>
                <button class="test-example-btn" data-selector=":focus-visible">:focus-visible</button>
              </div>
            </div>
          </div>

          <style>
            .test-example-btn {
              padding: 8px 16px;
              background: var(--primary-light);
              color: var(--primary-dark);
              border: 2px solid var(--primary);
              border-radius: var(--radius-md);
              font-family: var(--font-mono);
              font-size: 0.9rem;
              cursor: pointer;
              transition: all var(--transition-base);
              font-weight: 600;
            }
            .test-example-btn:hover {
              background: var(--primary);
              color: white;
              transform: translateY(-2px);
              box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            }
          </style>

          <script>
            function testSelector() {
              const input = document.getElementById('selector-test-input');
              const resultContent = document.getElementById('test-result-content');
              const selector = input.value.trim();

              if (!selector) {
                resultContent.innerHTML = '<div style="color: var(--error);">âŒ è¯·è¾“å…¥é€‰æ‹©å™¨</div>';
                return;
              }

              const supported = window.checkSelectorSupport(selector);

              if (supported) {
                resultContent.innerHTML = `
                  <div style="color: var(--success); font-weight: 600; font-size: 1.1rem; margin-bottom: 10px;">
                    âœ“ æ‚¨çš„æµè§ˆå™¨æ”¯æŒæ­¤é€‰æ‹©å™¨
                  </div>
                  <div style="color: var(--text-primary);">
                    <strong>é€‰æ‹©å™¨ï¼š</strong>
                    <code style="background: var(--gray-700); color: var(--gray-200); padding: 4px 12px; border-radius: 4px; font-size: 1rem;">${selector}</code>
                  </div>
                  <div style="margin-top: 10px; padding: 10px; background: var(--success-light); border-radius: 6px; color: var(--text-primary);">
                    æ‚¨å¯ä»¥åœ¨é¡¹ç›®ä¸­å®‰å…¨ä½¿ç”¨æ­¤é€‰æ‹©å™¨ã€‚
                  </div>
                `;
              } else {
                resultContent.innerHTML = `
                  <div style="color: var(--error); font-weight: 600; font-size: 1.1rem; margin-bottom: 10px;">
                    âœ— æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒæ­¤é€‰æ‹©å™¨
                  </div>
                  <div style="color: var(--text-primary);">
                    <strong>é€‰æ‹©å™¨ï¼š</strong>
                    <code style="background: var(--gray-700); color: var(--gray-200); padding: 4px 12px; border-radius: 4px; font-size: 1rem;">${selector}</code>
                  </div>
                  <div style="margin-top: 10px; padding: 10px; background: var(--error-light); border-radius: 6px; color: var(--text-primary);">
                    <strong>å»ºè®®ï¼š</strong>ä½¿ç”¨é™çº§æ–¹æ¡ˆæˆ– polyfillã€‚æŸ¥çœ‹ <a href="polyfill-guide.md" style="color: var(--primary); font-weight: 600;">Polyfill æŒ‡å—</a> äº†è§£è¯¦æƒ…ã€‚
                  </div>
                `;
              }
            }

            document.addEventListener('DOMContentLoaded', function () {
              const input = document.getElementById('selector-test-input');
              const testBtn = document.getElementById('test-selector-btn');

              testBtn.addEventListener('click', testSelector);

              input.addEventListener('keypress', function (e) {
                if (e.key === 'Enter') {
                  testSelector();
                }
              });

              // å¿«æ·æµ‹è¯•æŒ‰é’®
              document.querySelectorAll('.test-example-btn').forEach((btn) => {
                btn.addEventListener('click', function () {
                  const selector = this.getAttribute('data-selector');
                  input.value = selector;
                  testSelector();
                });
              });

              // åˆå§‹æµ‹è¯•
              testSelector();
            });
          </script>
        </section>

        <!-- å®Œæ•´æ£€æµ‹æŠ¥å‘Š -->
        <section class="compatibility-section">
          <h2>æµè§ˆå™¨å…¼å®¹æ€§æŠ¥å‘Š</h2>
          <p>ä»¥ä¸‹æ˜¯æ‚¨çš„æµè§ˆå™¨å¯¹æ‰€æœ‰ç°ä»£ CSS é€‰æ‹©å™¨çš„æ”¯æŒæƒ…å†µï¼š</p>
          <!-- æŠ¥å‘Šå°†ç”± compatibility-check.js è‡ªåŠ¨æ’å…¥ -->
        </section>

        <!-- Polyfill å»ºè®® -->
        <section class="demo-section">
          <h2>Polyfill å’Œé™çº§æ–¹æ¡ˆ</h2>
          <p style="color: var(--text-secondary); margin-bottom: 20px">
            å¦‚æœæ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒæŸäº›é€‰æ‹©å™¨ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ¡ˆï¼š
          </p>

          <div class="polyfill-notice">
            <h3>ğŸ“š Polyfill æŒ‡å—</h3>
            <p>æˆ‘ä»¬æä¾›äº†è¯¦ç»†çš„ Polyfill å’Œé™çº§æ–¹æ¡ˆæŒ‡å—ï¼ŒåŒ…æ‹¬ï¼š</p>
            <ul>
              <li>JavaScript Polyfill å®ç°</li>
              <li>CSS @supports é™çº§æ ·å¼</li>
              <li>æ¨èçš„ç¬¬ä¸‰æ–¹åº“</li>
              <li>æœ€ä½³å®è·µå’Œæ€§èƒ½å»ºè®®</li>
            </ul>
            <p>
              <a href="polyfill-guide.md" target="_blank">æŸ¥çœ‹å®Œæ•´çš„ Polyfill æŒ‡å— â†’</a>
            </p>
          </div>

          <h3>å¿«é€Ÿé™çº§ç¤ºä¾‹</h3>
          <div class="demo-code">
            <pre><code><span class="code-comment">/* ä½¿ç”¨ @supports æä¾›é™çº§æ ·å¼ */</span>

<span class="code-comment">/* ç°ä»£æµè§ˆå™¨ */</span>
@supports selector(:has(*)) {
  .card:has(img) {
    border-color: blue;
  }
}

<span class="code-comment">/* é™çº§æ–¹æ¡ˆ */</span>
@supports not selector(:has(*)) {
  .card.has-image {
    border-color: blue;
  }
}

<span class="code-comment">/* JavaScript æ·»åŠ ç±»å */</span>
document.querySelectorAll('.card').forEach(card => {
  if (card.querySelector('img')) {
    card.classList.add('has-image');
  }
});</code></pre>
          </div>
        </section>

        <!-- @supports æ¼”ç¤º -->
        <section class="demo-section">
          <h2>@supports ç‰¹æ€§æŸ¥è¯¢æ¼”ç¤º</h2>
          <p style="color: var(--text-secondary); margin-bottom: 20px">
            ä¸‹é¢çš„ç›’å­ä¼šæ ¹æ®æµè§ˆå™¨æ”¯æŒæƒ…å†µæ˜¾ç¤ºä¸åŒçš„æ ·å¼ã€‚
          </p>

          <style>
            .supports-demo-box {
              padding: 30px;
              border-radius: 12px;
              text-align: center;
              font-weight: 600;
              font-size: 1.1rem;
              margin: 20px 0;
            }

            /* é»˜è®¤æ ·å¼ï¼ˆæ‰€æœ‰æµè§ˆå™¨ï¼‰ */
            .supports-demo-box {
              background: var(--bg-secondary);
              border: 2px solid var(--border-color);
              color: var(--text-secondary);
            }

            /* æ”¯æŒ :has() çš„æµè§ˆå™¨ */
            @supports selector(:has(*)) {
              .supports-demo-box {
                background: var(--success-light);
                border-color: var(--success);
                color: var(--success-dark);
              }

              .supports-demo-box::before {
                content: 'âœ“ ';
                font-size: 1.5rem;
              }
            }

            /* ä¸æ”¯æŒ :has() çš„æµè§ˆå™¨ */
            @supports not selector(:has(*)) {
              .supports-demo-box {
                background: var(--warning-light);
                border-color: var(--warning);
                color: var(--warning-dark);
              }

              .supports-demo-box::before {
                content: 'âš ï¸ ';
                font-size: 1.5rem;
              }
            }
          </style>

          <div class="supports-demo-box">æ‚¨çš„æµè§ˆå™¨å¯¹ :has() çš„æ”¯æŒçŠ¶æ€</div>

          <div class="demo-code">
            <pre><code><span class="code-comment">/* é»˜è®¤æ ·å¼ */</span>
.box {
  background: gray;
}

<span class="code-comment">/* æ”¯æŒæ—¶çš„å¢å¼ºæ ·å¼ */</span>
@supports selector(:has(*)) {
  .box {
    background: green;
  }
}

<span class="code-comment">/* ä¸æ”¯æŒæ—¶çš„é™çº§æ ·å¼ */</span>
@supports not selector(:has(*)) {
  .box {
    background: orange;
  }
}</code></pre>
          </div>
        </section>
      </div>
    </main>
  </body>
</html>
